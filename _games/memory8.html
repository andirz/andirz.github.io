---
layout: table
title: Pack Picker Memory
icon: "fas fa-brain"
order: 2
description: "Match all Sims 4 Expansion, Game, and Stuff Packs. Watch out: at 10 misses, a found pair hides again!"
mode: Memory
difficulty: Hard
---

<chaos-memory
  ep-count="18"
  gp-count="12"
  sp-count="18"
  sp-extra="46, 49"
  pairs="12"
  time-limit="120"
  folder="{{ '/assets/img/packs/mono/' | relative_url }}"
  exclude="gp09">
</chaos-memory>

<style>
  chaos-memory{ display:block; margin: 1.25rem auto; max-width: 1000px; }
</style>

{% raw %}
<script>
(() => {
  try {
    if (customElements.get("chaos-memory")) return;

    const tpl = document.createElement("template");
    tpl.innerHTML = `
      <style>
        :host{
          --bg:#ffffff; --card:#ffffff; --ink:#0b0b0b; --muted:#4b5563;
          --border:#d1d1d1; --shadow:0 14px 20px -10px rgba(0,0,0,.18);
          --radius:22px; --gap:10px; --flip:0.42s cubic-bezier(.175,.885,.32,1.22);
          --size:146px; display:block;
        }
        .shell{
          background: var(--bg); border: 1px solid var(--border);
          border-radius: var(--radius); box-shadow: var(--shadow);
          padding: 1.1rem; position: relative;
        }
        .top{
          display:flex; justify-content:space-between; align-items:flex-start;
          gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;
        }
        h2{ margin:0; font-size:1.3rem; font-weight:850; color:var(--ink); letter-spacing:-.01em; }
        p{ margin:.25rem 0 0; color:var(--muted); font-size:.9rem; }
        
        .stats-wrapper {
          display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;
        }
        .sound-toggle {
          display: flex; align-items: center; gap: 0.4rem; font-size: 0.8rem;
          font-weight: 700; color: var(--muted); cursor: pointer; user-select: none;
        }
        .sound-toggle input { cursor: pointer; margin: 0; }

        .stats{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
        .pill{
          background: var(--card); border: 2px solid var(--border); border-radius: 999px;
          padding: .42rem .7rem; font-weight: 800; color: var(--ink); font-size: .85rem;
          min-width: 110px; text-align:center; position:relative; user-select:none;
        }
        .pill.chaos-active{ background: #ef4444; border-color:#ef4444; color:#fff; transform: scale(1.08); transition: 0.25s; }
        .pill.timer-urgent{ background: #ef4444; border-color:#ef4444; color:#fff; animation: pulseUrgent 0.9s ease-in-out infinite; }
        
        @keyframes pulseUrgent{ 0%{transform:scale(1)} 50%{transform:scale(1.08)} 100%{transform:scale(1)} }
        
        .btn{
          background: #0b0b0b; color:#fff; border:none; border-radius: 12px;
          padding: .5rem .9rem; font-weight: 850; font-size: .9rem; cursor:pointer;
        }
        .grid{ display:grid; gap: var(--gap); justify-content:center; perspective: 1100px; margin: 0 auto; }
        
        @media (min-width: 621px){ .grid{ grid-template-columns: repeat(6, var(--size)); } }
        @media (max-width: 620px){
          :host{ --size: 88px; --gap: 6px; }
          .grid{ grid-template-columns: repeat(4, var(--size)); }
          .pill{ min-width: 80px; font-size: 0.75rem; padding: 0.3rem 0.5rem; }
          h2{ font-size: 1.1rem; }
        }

        .card{
          width: var(--size); height: var(--size); position:relative;
          transform-style:preserve-3d; transition: transform var(--flip);
          cursor:pointer; border-radius: 14px; border: 0; padding: 0; background: transparent;
        }
        .card[state="up"], .card[state="match"]{ transform: rotateY(180deg); }
        .card[state="match"]{ pointer-events:none; }
        .face{ position:absolute; inset:0; backface-visibility:hidden; border-radius: 12px; display:flex; align-items:center; justify-content:center; overflow:hidden; }
        .front{ background: #0b0b0b; border: 2px solid rgba(255,255,255,.10); color:#ffffff; font-weight: 900; font-size: 1.2rem; }
        .back{ background: var(--card); transform: rotateY(180deg); border: 2px solid #0b0b0b; padding: 10px; }
        .back img{ width:100%; height:100%; object-fit:contain; }

        .bonus-text{
          position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
          font-weight: 900; pointer-events: none; opacity: 0; animation: floatUp 1s forwards;
        }
        .pos { color: #22c55e; } .neg { color: #ef4444; }
        @keyframes floatUp {
          0% { opacity: 0; transform: translate(-50%, 10px); }
          20% { opacity: 1; }
          100% { opacity: 0; transform: translate(-50%, -30px); }
        }

        .overlay{
          position:absolute; inset:0; display:none; align-items:center; justify-content:center;
          background: rgba(255,255,255,.85); backdrop-filter: blur(4px); border-radius: var(--radius); z-index:100;
        }
        .overlay[open]{ display:flex; }
        .modal{ width:min(400px, calc(100% - 28px)); background: #fff; border: 2px solid #0b0b0b; border-radius: 18px; padding: 1.5rem; text-align:center; box-shadow: var(--shadow); }
      </style>

      <div class="shell">
        <div class="top">
          <div class="title">
            <h2>Pack Picker Memory</h2>
            <p>At 10 misses: a random matched pair will close again!</p>
          </div>
          <div class="stats-wrapper">
            <label class="sound-toggle">
              <input type="checkbox" id="sound-chk"> Sound enabled
            </label>
            <div class="stats">
              <div class="pill" id="status">Pairs: 0 / 0</div>
              <div class="pill" id="misses-pill">Misses: 0</div>
              <div class="pill" id="timer-pill">
                <span id="timer">00:00</span>
                <div id="bonus-container"></div>
              </div>
              <button class="btn" id="restart">Restart</button>
            </div>
          </div>
        </div>

        <div class="grid" id="grid"></div>

        <div class="overlay" id="overlay">
          <div class="modal">
            <h3 id="ovTitle">Victory!</h3>
            <p id="ovMsg"></p>
            <button class="btn" id="restart2">Play Again</button>
          </div>
        </div>
      </div>
    `;

    class ChaosMemory extends HTMLElement{
      constructor(){
        super();
        this.attachShadow({mode:"open"});
        this.shadowRoot.appendChild(tpl.content.cloneNode(true));

        this.$grid = this.shadowRoot.getElementById("grid");
        this.$status = this.shadowRoot.getElementById("status");
        this.$missesPill = this.shadowRoot.getElementById("misses-pill");
        this.$timerPill = this.shadowRoot.getElementById("timer-pill");
        this.$timer = this.shadowRoot.getElementById("timer");
        this.$bonusContainer = this.shadowRoot.getElementById("bonus-container");
        this.$overlay = this.shadowRoot.getElementById("overlay");
        this.$soundChk = this.shadowRoot.getElementById("sound-chk");

        this._deck = [];
        this._open = [];
        this._locked = false;
        this._matches = 0;
        this._misses = 0;
        this._timeLeft = 0;
        this._timerId = null;
        this._ac = null;
        this._lastTickSecond = null;
      }

      connectedCallback(){
        this.shadowRoot.getElementById("restart").onclick = () => this._reset();
        this.shadowRoot.getElementById("restart2").onclick = () => this._reset();
        this.$grid.onclick = (e) => this._onClick(e);
        
        // Sound Preference laden
        const savedSound = localStorage.getItem('memory-sound-enabled');
        this.$soundChk.checked = savedSound === null ? true : savedSound === 'true';
        this.$soundChk.onchange = () => localStorage.setItem('memory-sound-enabled', this.$soundChk.checked);

        this._reset();
      }

      _ensureAudio(){
        if (this._ac) return;
        const Ctx = window.AudioContext || window.webkitAudioContext;
        if (!Ctx) return;
        this._ac = new Ctx();
      }

      _beep(freq, ms, type, gain){
        if(!this.$soundChk.checked) return;
        try{
          this._ensureAudio();
          if(!this._ac) return;
          if (this._ac.state === "suspended") this._ac.resume().catch(() => {});
          const o = this._ac.createOscillator();
          const g = this._ac.createGain();
          o.type = type || "sine";
          o.frequency.value = freq;
          const now = this._ac.currentTime;
          const a = Math.max(0.0001, (gain == null ? 0.03 : gain));
          g.gain.setValueAtTime(0.0001, now);
          g.gain.exponentialRampToValueAtTime(a, now + 0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, now + (ms/1000));
          o.connect(g); g.connect(this._ac.destination);
          o.start(now); o.stop(now + (ms/1000) + 0.02);
        } catch(e) {}
      }

      _sfx(name){
        if(name === "flip") return this._beep(520, 45, "triangle", 0.02);
        if(name === "match"){
          this._beep(660, 70, "sine", 0.03);
          return this._beep(880, 90, "sine", 0.03);
        }
        if(name === "miss") return this._beep(220, 110, "square", 0.02);
        if(name === "chaos"){
          this._beep(180, 120, "sawtooth", 0.02);
          return this._beep(120, 140, "sawtooth", 0.02);
        }
        if(name === "tick") return this._beep(990, 35, "square", 0.015);
        if(name === "tock") return this._beep(660, 35, "square", 0.015);
        if(name === "win") {
          this._beep(784, 120, "sine", 0.03);
          this._beep(988, 140, "sine", 0.03);
          return this._beep(1175, 180, "sine", 0.03);
        }
        if(name === "lose") {
          this._beep(196, 160, "triangle", 0.03);
          return this._beep(147, 220, "triangle", 0.03);
        }
      }

      get epCount(){ return parseInt(this.getAttribute("ep-count") || "18"); }
      get gpCount(){ return parseInt(this.getAttribute("gp-count") || "12"); }
      get spCount(){ return parseInt(this.getAttribute("sp-count") || "0"); }
      get pairs(){ return parseInt(this.getAttribute("pairs") || "12"); }
      get timeLimit(){ return parseInt(this.getAttribute("time-limit") || "120"); }
      get folder(){ 
        let f = (this.getAttribute("folder") || "").trim() || "/assets/img/packs/mono/";
        return f.endsWith("/") ? f : f + "/";
      }

      _buildPool(){
        const pool = [];
        for(let i=1;i<=this.epCount;i++) pool.push(`ep${String(i).padStart(2,"0")}`);
        for(let i=1;i<=this.gpCount;i++) pool.push(`gp${String(i).padStart(2,"0")}`);
        const extra = (this.getAttribute("sp-extra") || "").split(",").map(s => s.trim()).filter(Boolean);
        extra.forEach(num => pool.push(`sp${String(num).padStart(2,"0")}`));
        return pool;
      }

      _reset(){
        this.$overlay.removeAttribute("open");
        this._matches = 0; this._misses = 0;
        this._locked = false; this._open = [];
        this._timeLeft = this.timeLimit;
        this._lastTickSecond = null;
        this.$timerPill.classList.remove("timer-urgent");

        const pool = this._buildPool();
        const selected = pool.sort(() => 0.5 - Math.random()).slice(0, this.pairs);
        const shuffled = [...selected, ...selected].sort(() => 0.5 - Math.random());
        this._deck = shuffled.map(id => ({ id, matched: false }));

        this._render();
        this._updateUI();
        this._startTimer();
      }

      _render(){
        this.$grid.innerHTML = "";
        this._deck.forEach((cardObj, idx) => {
          const card = document.createElement("button");
          card.className = "card"; card.dataset.idx = idx;
          card.innerHTML = `<div class="face front">?</div><div class="face back"><img src="${this.folder}${cardObj.id}.png"></div>`;
          this.$grid.appendChild(card);
        });
      }

      _onClick(e){
        const card = e.target.closest(".card");
        if(!card || this._locked || card.getAttribute("state") === "match") return;

        // "Miss"-Schutz: Wenn Karte schon offen ("up"), dann einfach wieder schlieÃŸen
        if (card.getAttribute("state") === "up") {
          card.removeAttribute("state");
          this._open = [];
          this._sfx("flip");
          return;
        }

        this._sfx("flip");
        card.setAttribute("state", "up");
        this._open.push(card);

        if(this._open.length === 2){
          this._locked = true;
          const [c1, c2] = this._open;
          const d1 = this._deck[c1.dataset.idx];
          const d2 = this._deck[c2.dataset.idx];

          if(d1.id === d2.id){
            d1.matched = d2.matched = true;
            c1.setAttribute("state", "match"); c2.setAttribute("state", "match");
            this._matches++; this._open = []; this._locked = false;
            this._sfx("match"); this._showFloat(10, true); this._updateUI();
            if(this._matches === this._deck.length/2) this._end("Victory!");
          } else {
            this._misses++;
            this._sfx("miss"); this._showFloat(1, false); this._updateUI();
            
            if(this._misses % 10 === 0){
              setTimeout(() => this._chaosCloseRandomPair(), 600);
            } else {
              setTimeout(() => {
                c1.removeAttribute("state"); c2.removeAttribute("state");
                this._open = []; this._locked = false;
              }, 800);
            }
          }
        }
      }

      _chaosCloseRandomPair(){
        const solvedIds = [...new Set(this._deck.filter(c => c.matched).map(c => c.id))];
        if (solvedIds.length > 0) {
          this._sfx("chaos");
          this.$missesPill.classList.add("chaos-active");
          const randomId = solvedIds[Math.floor(Math.random() * solvedIds.length)];
          this._deck.forEach((cardObj, idx) => {
            if (cardObj.id === randomId) {
              cardObj.matched = false;
              const el = this.$grid.querySelector(`[data-idx="${idx}"]`);
              if (el) el.removeAttribute("state");
            }
          });
          this._matches--;
          setTimeout(() => { this.$missesPill.classList.remove("chaos-active"); this._updateUI(); }, 500);
        }
        this._open = []; this._locked = false;
      }

      _showFloat(sec, pos){
        this._timeLeft = pos ? (this._timeLeft + sec) : Math.max(0, this._timeLeft - sec);
        const b = document.createElement("div");
        b.className = `bonus-text ${pos ? "pos" : "neg"}`; b.textContent = `${pos ? "+" : "-"}${sec}s`;
        this.$bonusContainer.appendChild(b);
        setTimeout(() => b.remove(), 1000);
      }

      _startTimer(){
        clearInterval(this._timerId);
        this._timerId = setInterval(() => {
          this._timeLeft--;
          const t = Math.max(0, this._timeLeft);
          const m = Math.floor(t / 60), s = t % 60;
          this.$timer.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
          
          if (t <= 10 && t > 0) {
            this.$timerPill.classList.add("timer-urgent");
            if (this._lastTickSecond !== t) {
              this._lastTickSecond = t;
              this._sfx(t % 2 === 0 ? "tick" : "tock");
            }
          } else {
            this.$timerPill.classList.remove("timer-urgent");
          }

          if(this._timeLeft <= 0){
            clearInterval(this._timerId);
            this._end("Game Over");
          }
        }, 1000);
      }

      _updateUI(){
        this.$status.textContent = `Pairs: ${this._matches}/${this._deck.length/2}`;
        this.$missesPill.textContent = `Misses: ${this._misses}`;
      }

      _end(t){
        clearInterval(this._timerId);
        this.shadowRoot.getElementById("ovTitle").textContent = t;
        this.shadowRoot.getElementById("ovMsg").textContent = `Pairs: ${this._matches} | Misses: ${this._misses}`;
        this.$overlay.setAttribute("open", "");
        this._sfx(t === "Victory!" ? "win" : "lose");
      }
    }
    customElements.define("chaos-memory", ChaosMemory);
  } catch (e) {}
})();
</script>
{% endraw %}