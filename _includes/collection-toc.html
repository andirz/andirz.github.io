{% comment %}
  Include: collection-toc.html

  Simple TOC from a collection.
  All entries are ALWAYS clickable.

  Parameters:
  - collection:  required (e.g. "support", "wiki", "tutorials")
  - title:       optional (default: "On this page")
  - sort:        optional (default: "order")
  - order:       optional "asc" | "desc" (default: "asc")
  - where_key:   optional (e.g. "toc")
  - where_val:   optional (e.g. true)
  - limit:       optional number
  - show_desc:   optional true|false (default: false)
  - show_icons:  optional true|false (default: true)
  - max_desc:    optional (default: 90)
  - width:       optional (default: "min(320px, 36%)")
{% endcomment %}

{% assign _col = include.collection | to_s %}
{% assign _title = include.title | default: "On this page" %}
{% assign _sort = include.sort | default: "order" %}
{% assign _order = include.order | default: "asc" %}

{% assign _show_desc = include.show_desc %}
{% if _show_desc == nil %}{% assign _show_desc = false %}{% endif %}

{% assign _show_icons = include.show_icons %}
{% if _show_icons == nil %}{% assign _show_icons = true %}{% endif %}

{% assign _max_desc = include.max_desc | default: 90 %}
{% assign _width = include.width | default: "min(320px, 36%)" %}

{% assign _items = site[_col] %}

{% if _items != nil %}

  {% if include.where_key %}
    {% assign _items = _items | where: include.where_key, include.where_val %}
  {% endif %}

  {% assign _items = _items | sort: _sort %}
  {% if _order == "desc" %}
    {% assign _items = _items | reverse %}
  {% endif %}

  {% if include.limit %}
    {% assign _items = _items | slice: 0, include.limit %}
  {% endif %}

  <aside class="collection-toc" style="width: {{ _width }};">
    <div class="collection-toc__head">
      <span class="collection-toc__title">{{ _title }}</span>
    </div>

    <ul class="collection-toc__list {% if _show_icons == false %}no-icons{% endif %}">
      {% for p in _items %}
        {% assign icon = p.icon | default: "fas fa-file-alt" %}

        <li class="collection-toc__item">
          <a class="collection-toc__link" href="{{ p.url | relative_url }}">
            {% if _show_icons %}
              <i class="{{ icon }}" aria-hidden="true"></i>
            {% endif %}
            <span class="collection-toc__text">
              {{ p.toc_title | default: p.title }}
            </span>
          </a>

          {% if _show_desc and p.description %}
            <div class="collection-toc__desc">
              {% assign d = p.description | strip_html | strip_newlines %}
              {% if d.size > _max_desc %}
                {{ d | slice: 0, _max_desc }}â€¦
              {% else %}
                {{ d }}
              {% endif %}
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </aside>

  <style>
    .collection-toc{
      float: right;
      margin: 0 0 1rem 1.25rem;
      position: relative;
      z-index: 10;
      padding: 0.85rem 0.9rem;
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 14px;
      background: var(--card-bg, #fff);
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
    }

    .collection-toc__head{
      display:flex;
      align-items:center;
      margin-bottom: 0.65rem;
      padding-bottom: 0.55rem;
      border-bottom: 1px solid rgba(0,0,0,0.08);
    }

    .collection-toc__title{
      font-weight: 650;
      letter-spacing: -0.2px;
    }

    .collection-toc__list{
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.35rem;
    }

    .collection-toc__link{
      display: flex;
      align-items: center;
      gap: 0.55rem;
      line-height: 1.25;
      text-decoration: none;
      pointer-events: auto;
      cursor: pointer;
    }

    .collection-toc__list.no-icons .collection-toc__link{
      gap: 0;
    }

    .collection-toc i{
      font-size: 0.95rem;
      opacity: 0.75;
      width: 1.1rem;
      text-align: center;
    }

    .collection-toc__desc{
      margin-left: calc(1.1rem + 0.55rem);
      font-size: 0.88rem;
      opacity: 0.75;
    }

    .collection-toc__list.no-icons .collection-toc__desc{
      margin-left: 0;
    }

    @media (max-width: 980px){
      .collection-toc{
        float: none;
        width: 100% !important;
        margin: 0 0 1rem 0;
      }
    }
  </style>

{% endif %}
