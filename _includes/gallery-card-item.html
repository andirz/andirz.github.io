{% assign g_mod_data = include.mod_data %}
{% comment %} Suche die tatsächliche Seite (File) für diese Mod ID, um Frontmatter-Titel/Icon zu erhalten {% endcomment %}
{% assign mod_page = site.pages | where: "mod_id", g_mod_data.id | first %}

{% comment %} Priorität: 1. Mod-Seite Frontmatter, 2. YAML-Daten Fallback {% endcomment %}
{% assign final_title = mod_page.title | default: g_mod_data.name %}
{% assign final_icon = mod_page.icon | default: g_mod_data.icon | default: 'fas fa-box' %}

{% assign mod_url_slug = g_mod_data.id | replace: '_', '-' %}
{% assign final_url = '/mods/' | append: mod_url_slug | append: '/' | relative_url %}

{% assign thirty_days = 2592000 %}
{% assign now_seconds = "now" | date: "%s" | plus: 0 %}
{% assign mod_seconds = g_mod_data.updated | date: "%s" | plus: 0 %}
{% assign diff = now_seconds | minus: mod_seconds %}

<div class="gallery-card" style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column; transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative; height: 100%;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 20px rgba(0,0,0,0.05)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
  
  {% if diff < thirty_days %}
    <div style="position: absolute; top: 12px; left: 12px; z-index: 10; background: #ef4444; color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.65rem; font-weight: 900; text-transform: uppercase;">New Update</div>
  {% endif %}

  <a href="{{ final_url }}" style="display: block; aspect-ratio: 16/9; background: #f8fafc; position: relative; text-decoration: none; border-bottom: 1px solid #f1f5f9;">
    {% if g_mod_data.image %}
      <img src="{{ g_mod_data.image | relative_url }}" alt="{{ final_title }}" style="width: 100%; height: 100%; object-fit: cover;">
    {% else %}
      <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #cbd5e1;">
        <i class="{{ final_icon }}" style="font-size: 2.5rem;"></i>
      </div>
    {% endif %}
  </a>

  <div style="padding: 18px; flex-grow: 1; display: flex; flex-direction: column;">
    <h3 style="margin: 0 0 12px 0; font-size: 1rem; font-weight: 700; color: #1e293b; line-height: 1.3;">
      <a href="{{ final_url }}" style="text-decoration: none; color: inherit;">{{ final_title }}</a>
    </h3>
    
    <div style="margin-top: auto; display: flex; justify-content: space-between; align-items: center;">
      <div style="display: flex; align-items: center; gap: 6px; color: #94a3b8;">
        <i class="{{ final_icon }}" style="font-size: 0.75rem;"></i>
        <span style="font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">{{ g_mod_data.categories | first }}</span>
      </div>
      <span style="font-size: 0.75rem; color: #94a3b8; font-weight: 600; font-family: monospace;">v. {{ g_mod_data.version }}</span>
    </div>
  </div>
</div>
