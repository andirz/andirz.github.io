{% assign g_mod_data = include.mod_data %}
{% assign mod_page = site.mods | where: "mod_id", g_mod_data.id | first %}

{% comment %} --- AUTOMATISCHE BILD-SUCH-LOGIK --- {% endcomment %}
{% assign card_image = nil %}
{% assign fallback_img = nil %}
{% assign mod_img_folder = "/assets/img/mods/" | append: g_mod_data.id | append: "/" %}

{% for file in site.static_files %}
  {% if file.path contains mod_img_folder %}
    {% comment %} Wir suchen cover.png oder cover.jpg {% endcomment %}
    {% if file.name contains "cover" %}
      {% assign card_image = file.path %}
      {% break %}
    {% elsif fallback_img == nil %}
      {% comment %} Merke dir das erste Bild im Ordner als Fallback {% endcomment %}
      {% if file.extname == ".png" or file.extname == ".jpg" or file.extname == ".jpeg" or file.extname == ".webp" %}
        {% assign fallback_img = file.path %}
      {% endif %}
    {% endif %}
  {% endif %}
{% endfor %}

{% assign final_image = card_image | default: fallback_img %}
{% comment %} --- BILD-SUCH-LOGIK ENDE --- {% endcomment %}

{% assign final_title = mod_page.title | default: g_mod_data.name %}
{% assign final_icon  = mod_page.icon  | default: g_mod_data.icon | default: 'fas fa-box' %}
{% assign mod_url_slug = g_mod_data.id | replace: '_', '-' %}
{% assign final_url = '/mods/' | append: mod_url_slug | append: '/' | relative_url %}

<div class="gallery-card" style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column; transition: all 0.2s ease; height: 100%;" 
     onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 20px rgba(0,0,0,0.05)';" 
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">

  <a href="{{ final_url }}" style="display: block; aspect-ratio: 16/9; background: #f8fafc; position: relative; text-decoration: none; overflow: hidden;">
    {% if final_image %}
      <img src="{{ final_image | relative_url }}" alt="{{ final_title }}" style="width: 100%; height: 100%; object-fit: cover;">
    {% else %}
      <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f1f5f9; color: #cbd5e1;">
        <i class="{{ final_icon }}" style="font-size: 4rem;"></i>
      </div>
    {% endif %}
  </a>

  <div style="padding: 18px; flex-grow: 1; display: flex; flex-direction: column;">
    <h3 style="margin: 0 0 12px 0; font-size: 1rem; font-weight: 700; color: #1e293b;">
      <a href="{{ final_url }}" style="text-decoration: none; color: inherit;">{{ final_title }}</a>
    </h3>
    <div style="margin-top: auto; display: flex; justify-content: space-between; align-items: center; color: #94a3b8; font-size: 0.75rem;">
       <span><i class="fas fa-layer-group me-1"></i> {{ g_mod_data.version }}</span>
       <span style="font-weight: 700; text-transform: uppercase;">{{ g_mod_data.status }}</span>
    </div>
  </div>
</div>
