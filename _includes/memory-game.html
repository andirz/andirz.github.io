<style>
  .memory-section {
    background: white;
    border-radius: 24px;
    padding: 30px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
    margin: 40px 0;
    font-family: sans-serif;
  }

  .memory-grid {
    display: grid;
    gap: 10px;
    max-width: 600px;
    margin: 0 auto;
  }

  /* Grid-Konfigurationen */
  .grid-4 { grid-template-columns: repeat(4, 1fr); }
  .grid-6 { grid-template-columns: repeat(6, 1fr); }

  .m-card {
    aspect-ratio: 1;
    cursor: pointer;
    perspective: 1000px;
  }

  .m-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
  }

  .m-card.flipped .m-inner { transform: rotateY(180deg); }

  .m-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .m-front {
    background: #1e293b;
    color: rgba(255,255,255,0.3);
    border: 1px solid rgba(255,255,255,0.1);
  }

  .m-back {
    background: #f8fafc;
    border: 2px solid #3498db;
    transform: rotateY(180deg);
    padding: 5px;
  }

  .m-back img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .game-controls {
    background: #f1f5f9;
    padding: 20px;
    border-radius: 16px;
  }

  .timer-danger { 
    color: #e74c3c; 
    font-weight: bold;
    animation: pulse 1s infinite;
  }

  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }
</style>

<section class="memory-section">
  <div class="row align-items-start">
    <div class="col-lg-4 mb-4">
      <h2 class="fw-800 mb-3" style="color: #1e293b;">Pack Picker</h2>
      
      <div class="game-controls">
        <div class="mb-3">
          <label class="small fw-bold d-block mb-2 text-uppercase">Schwierigkeit</label>
          <select id="gridSize" class="form-select border-0 shadow-sm" onchange="initGame()">
            <option value="16" data-cols="4" data-time="45">Normal (4x4 • 45s)</option>
            <option value="36" data-cols="6" data-time="100">Expert (6x6 • 100s)</option>
          </select>
        </div>
        
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="small text-muted">Matches:</span>
          <span id="game-status" class="fw-bold">0 / 8</span>
        </div>
        
        <div class="d-flex justify-content-between align-items-center mb-4">
          <span class="small text-muted">Zeit:</span>
          <span id="game-timer" class="fw-bold">--s</span>
        </div>
        
        <button class="btn btn-dark w-100 fw-bold py-2" onclick="initGame()">Spiel neu starten</button>
      </div>
    </div>
    
    <div class="col-lg-8">
      <div id="memoryGrid" class="memory-grid grid-4"></div>
    </div>
  </div>
</section>

<script>
  (function() {
    const basePath = "{{ 'assets/img/packs_blue/' | relative_url }}";
    // Liste deiner verfügbaren Asset-Namen
    const epPacks = Array.from({length: 18}, (_, i) => `ep${(i + 1).toString().padStart(2, '0')}`);
    const gpPacks = Array.from({length: 12}, (_, i) => `gp${(i + 1).toString().padStart(2, '0')}`);
    const allPacksList = [...epPacks, ...gpPacks];

    let flippedCards = [];
    let lockBoard = false;
    let matches = 0;
    let totalPairs = 8;
    let timeLeft = 0;
    let timerInterval = null;

    const grid = document.getElementById('memoryGrid');
    const statusLabel = document.getElementById('game-status');
    const timerLabel = document.getElementById('game-timer');
    const sizeSelect = document.getElementById('gridSize');

    window.initGame = function() {
      clearInterval(timerInterval);
      grid.innerHTML = '';
      flippedCards = [];
      lockBoard = false;
      matches = 0;
      
      const selectedOption = sizeSelect.options[sizeSelect.selectedIndex];
      const totalCards = parseInt(selectedOption.value);
      const cols = selectedOption.dataset.cols;
      totalPairs = totalCards / 2;
      timeLeft = parseInt(selectedOption.dataset.time);
      
      grid.className = `memory-grid grid-${cols}`;
      statusLabel.innerText = `0 / ${totalPairs}`;
      timerLabel.innerText = `${timeLeft}s`;
      timerLabel.classList.remove('timer-danger');

      // Wähle zufällige Packs basierend auf der benötigten Paar-Anzahl
      let selected = [...allPacksList].sort(() => 0.5 - Math.random()).slice(0, totalPairs);
      let deck = [...selected, ...selected].sort(() => 0.5 - Math.random());
      
      deck.forEach(pack => grid.appendChild(createCard(pack)));
      startTimer();
    }

    function createCard(packName) {
      const card = document.createElement('div');
      card.classList.add('m-card');
      card.dataset.pack = packName;
      card.innerHTML = `
        <div class="m-inner">
          <div class="m-face m-front"><i class="fas fa-sim-card"></i></div>
          <div class="m-face m-back"><img src="${basePath}${packName}.png" alt="Pack"></div>
        </div>`;
      card.addEventListener('click', flipCard);
      return card;
    }

    function flipCard() {
      if (lockBoard || this === flippedCards[0] || this.classList.contains('flipped')) return;
      this.classList.add('flipped');
      flippedCards.push(this);
      if (flippedCards.length === 2) checkMatch();
    }

    function checkMatch() {
      lockBoard = true;
      const isMatch = flippedCards[0].dataset.pack === flippedCards[1].dataset.pack;
      
      if (isMatch) {
        matches++;
        statusLabel.innerText = `${matches} / ${totalPairs}`;
        flippedCards = [];
        lockBoard = false;
        if (matches === totalPairs) {
          clearInterval(timerInterval);
          setTimeout(() => alert('Sul Sul! Du hast alle Packs gefunden!'), 300);
        }
      } else {
        setTimeout(() => {
          flippedCards.forEach(card => card.classList.remove('flipped'));
          flippedCards = [];
          lockBoard = false;
        }, 700); // Etwas schnelleres Umdrehen für besseren Spielfluss
      }
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timeLeft--;
        timerLabel.innerText = `${timeLeft}s`;
        if (timeLeft <= 10) timerLabel.classList.add('timer-danger');
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          lockBoard = true;
          alert('Time Out! Versuch es nochmal.');
        }
      }, 1000);
    }

    // Startet das Spiel direkt beim Laden
    initGame();
  })();
</script>