{% assign mod = site.data.mods | where: "id", page.mod_id | first %}
{% assign current_version = page.version | default: mod.version %}
{% assign last_updated = page.updated | default: mod.updated %}
{% include mod-status-color.html %}

<header class="mod-header" style="margin-bottom:26px; padding-bottom:20px; border-bottom:1px solid #f1f5f9;">

  <h1 style="font-size:2.5rem; font-weight:400; letter-spacing:-0.5px; margin:0 0 14px 0; color:#1e293b; line-height:1.2;">
    {{ mod.name | default: page.title }}
  </h1>

  <div class="mod-tags-row" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:18px;">
    {% if mod.status %}
      <span style="background:{{ status_color }}; color:#fff; padding:5px 14px; border-radius:6px; font-weight:700; font-size:.75rem; text-transform:uppercase; letter-spacing:.5px;">
        {{ mod.status }}
      </span>
    {% endif %}

    {% assign categories = page.categories | default: mod.categories %}
    {% for cat in categories %}
      <a
        href="{{ site.baseurl }}/category/?category={{ cat | url_encode }}"
        title="Browse category: {{ cat }}"
        style="
          border:1px solid #e2e8f0;
          color:#64748b;
          padding:5px 14px;
          border-radius:6px;
          font-size:.8rem;
          font-weight:600;
          background:#f8fafc;
          text-decoration:none;
          display:inline-block;
          outline:none;
          transition: border-color .12s ease, box-shadow .12s ease, background-color .12s ease;
        "
        onmouseover="
          this.style.borderColor='rgba(0,0,0,.22)';
          this.style.boxShadow='0 0 0 3px rgba(0,0,0,.05)';
        "
        onmouseout="
          this.style.borderColor='';
          this.style.boxShadow='';
          this.style.backgroundColor='';
        "
        onmousedown="
          this.style.borderColor='rgba(0,0,0,.35)';
          this.style.boxShadow='0 0 0 4px rgba(0,0,0,.09)';
          this.style.backgroundColor='rgba(0,0,0,.03)';
        "
        onmouseup="
          this.style.borderColor='rgba(0,0,0,.22)';
          this.style.boxShadow='0 0 0 3px rgba(0,0,0,.05)';
        "
      >
        {{ cat }}
      </a>
    {% endfor %}

  </div>

  <div style="display:flex; align-items:center; gap:12px; color:#64748b; font-size:.9rem; flex-wrap:wrap; margin-top:-4px;">

    {% assign first_file = page.files | first %}
    <div style="display:flex; align-items:center; gap:16px;">
      <div style="color:#cbd5e1; font-size:1.2rem; width:22px; text-align:center;">
        {% if first_file == "ts4script" %}
          <i class="fas fa-file-code"></i>
        {% elsif first_file == "bat" %}
          <i class="fas fa-terminal"></i>
        {% else %}
          <i class="fas fa-box-open"></i>
        {% endif %}
      </div>
      <div style="display:flex; flex-direction:column; line-height:1.1;">
        <span style="text-transform:uppercase; font-size:.6rem; letter-spacing:.5px; color:#94a3b8; font-weight:700;">
          File Type
        </span>
        <span style="font-weight:600; color:#475569; font-size:.9rem;">
          {{ first_file | default: "package" | replace:"ts4script","Script" | replace:"bat","Batch" | capitalize }}
        </span>
      </div>
    </div>

    <div style="display:flex; align-items:center; gap:12px; padding-left:20px; border-left:1px solid #f1f5f9;">
      <i class="fas fa-code-branch" style="color:#cbd5e1;"></i>
      <div style="display:flex; flex-direction:column;">
        <span style="text-transform:uppercase; font-size:.6rem; color:#94a3b8; font-weight:700; margin-bottom:0px;">
          Last Version
        </span>
        <span style="font-weight:600; color:#475569;">v. {{ current_version }}</span>
      </div>
    </div>

    <div style="display:flex; align-items:center; gap:12px; padding-left:20px; border-left:1px solid #f1f5f9;">
      <i class="fas fa-calendar-alt" style="color:#cbd5e1;"></i>
      <div style="display:flex; flex-direction:column;">
        <span style="text-transform:uppercase; font-size:.6rem; color:#94a3b8; font-weight:700; margin-bottom:0px;">
          Last Update
        </span>
        <span style="font-weight:600; color:#475569;">
          {{ last_updated | date: "%b %d, %Y" }}
        </span>
      </div>
    </div>

{% assign mod_packs_raw = page.packs | default: mod.packs %}

{%- comment -%}
  Falls packs als String kommen (z.B. "EP01, GP08"), normalisieren wir auf Array.
{%- endcomment -%}
{% if mod_packs_raw and mod_packs_raw.size > 0 and mod_packs_raw.first == nil and mod_packs_raw contains "," %}
  {% assign mod_packs_raw = mod_packs_raw | split: "," %}
{% endif %}

{% assign required_pack_codes = "" | split:"|" %}
{% for p in mod_packs_raw %}
  {% assign code = p | strip %}
  {% if code and code != "" and code != "BG" %}
    {% assign required_pack_codes = required_pack_codes | push: code %}
  {% endif %}
{% endfor %}

{% if required_pack_codes.size > 0 %}
  <div style="display:flex; align-items:center; gap:10px; padding-left:20px; border-left:1px solid #f1f5f9;">
    {% for pack_code in required_pack_codes %}

      {% assign pack_data = site.data.packs[pack_code] %}
      {% assign pack_name = pack_code %}
      {% if pack_data %}
        {% assign pack_name = pack_data.en | default: pack_code %}
      {% endif %}

      {% assign icon_path = "/assets/img/packs/" | append: pack_code | downcase | append: ".png" %}
      {% assign icon_exists = false %}
      {% for file in site.static_files %}
        {% if file.path == icon_path %}
          {% assign icon_exists = true %}
          {% break %}
        {% endif %}
      {% endfor %}

      {% if icon_exists %}
        <img
          src="{{ site.baseurl }}{{ icon_path }}"
          alt="{{ pack_name }} ({{ pack_code }})"
          title="{{ pack_name }} ({{ pack_code }})"
          style="width:36px; height:36px; object-fit:contain;"
        >
      {% endif %}

    {% endfor %}
  </div>
{% endif %}

  </div>
</header>
