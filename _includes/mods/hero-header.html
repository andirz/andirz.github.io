{% assign mod = site.data.mods | where: "id", page.mod_id | first %}
{% assign current_version = page.version | default: mod.version %}
{% assign last_updated = page.updated | default: mod.updated %}
{% include mods/status-color.html %}

<header class="mod-header" style="margin-bottom:26px; padding-bottom:20px; border-bottom:1px solid #f1f5f9;">

  <h1 style="font-size:2.5rem; font-weight:400; letter-spacing:-0.5px; margin:0 0 14px 0; color:#1e293b; line-height:1.2;">
    {{ mod.name | default: page.title }}
  </h1>

  <div class="mod-tags-row" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:18px;">
    {% if mod.status %}
      <span style="background:{{ status_color }}; color:#fff; padding:6px 16px; border-radius:6px; font-weight:700; font-size:.8rem; text-transform:uppercase; letter-spacing:.5px;">
        {{ mod.status }}
      </span>
    {% endif %}

    {% assign categories = page.categories | default: mod.categories %}
    {% for cat in categories %}
      <a
        href="{{ site.baseurl }}/categories/?cat={{ cat | url_encode }}"
        title="Browse category: {{ cat }}"
        style="
          border:1px solid #e2e8f0;
          color:#64748b;
          padding:6px 16px;
          border-radius:6px;
          font-size:.85rem;
          font-weight:600;
          background:#f8fafc;
          text-decoration:none;
          display:inline-block;
          outline:none;
          transition: border-color .12s ease, box-shadow .12s ease, background-color .12s ease;
        "
        onmouseover="
          this.style.borderColor='rgba(0,0,0,.22)';
          this.style.boxShadow='0 0 0 3px rgba(0,0,0,.05)';
          this.style.backgroundColor='rgba(0,0,0,.02)';
        "
        onmouseout="
          this.style.borderColor='';
          this.style.boxShadow='';
          this.style.backgroundColor='';
        "
        onmousedown="
          this.style.borderColor='rgba(0,0,0,.35)';
          this.style.boxShadow='0 0 0 4px rgba(0,0,0,.09)';
          this.style.backgroundColor='rgba(0,0,0,.04)';
        "
        onmouseup="
          this.style.borderColor='rgba(0,0,0,.22)';
          this.style.boxShadow='0 0 0 3px rgba(0,0,0,.05)';
          this.style.backgroundColor='rgba(0,0,0,.02)';
        "
      >
        {{ cat }}
      </a>
    {% endfor %}
  </div>

  <div style="display:flex; align-items:center; gap:22px; flex-wrap:wrap;">

    {% assign first_file = page.files | first %}

    <!-- FILE TYPE -->
    <div style="display:flex; align-items:center; gap:14px;">
      <div style="color:#cbd5e1; font-size:1.15rem; width:22px; height:32px; display:flex; align-items:center; justify-content:center; text-align:center;">
        {% if first_file == "ts4script" %}
          <i class="fas fa-file-code"></i>
        {% elsif first_file == "bat" %}
          <i class="fas fa-terminal"></i>
        {% else %}
          <i class="fas fa-box-open"></i>
        {% endif %}
      </div>
      <div style="display:flex; flex-direction:column; line-height:1.25;">
        <span style="text-transform:uppercase; font-size:.65rem; letter-spacing:.6px; color:#94a3b8; font-weight:700;">
          File Type
        </span>
        <span style="font-weight:600; color:#334155; font-size:1.05rem;">
          {{ first_file | default: "package" | replace:"ts4script","Script" | replace:"bat","Batch" | capitalize }}
        </span>
      </div>
    </div>

    <!-- VERSION -->
    <div style="display:flex; align-items:center; gap:14px; padding-left:22px; border-left:1px solid #f1f5f9;">
      <div style="color:#cbd5e1; font-size:1.05rem; width:22px; height:32px; display:flex; align-items:center; justify-content:center;">
        <i class="fas fa-code-branch"></i>
      </div>
      <div style="display:flex; flex-direction:column; line-height:1.25;">
        <span style="text-transform:uppercase; font-size:.65rem; color:#94a3b8; font-weight:700;">
          Version
        </span>
        <span style="font-weight:600; color:#334155; font-size:1.05rem;">
          v. {{ current_version }}
        </span>
      </div>
    </div>

    <!-- LAST UPDATE -->
    <div style="display:flex; align-items:center; gap:14px; padding-left:22px; border-left:1px solid #f1f5f9;">
      <div style="color:#cbd5e1; font-size:1.05rem; width:22px; height:32px; display:flex; align-items:center; justify-content:center;">
        <i class="fas fa-calendar-alt"></i>
      </div>
      <div style="display:flex; flex-direction:column; line-height:1.25;">
        <span style="text-transform:uppercase; font-size:.65rem; color:#94a3b8; font-weight:700;">
          Last Update
        </span>
        <span style="font-weight:600; color:#334155; font-size:1.05rem;">
          {{ last_updated | date: "%b %d, %Y" }}
        </span>
      </div>
    </div>

    <!-- PACKS -->
    {% assign mod_packs_raw = page.packs | default: mod.packs %}
    {% if mod_packs_raw and mod_packs_raw.size > 0 and mod_packs_raw.first == nil and mod_packs_raw contains "," %}
      {% assign mod_packs_raw = mod_packs_raw | split: "," %}
    {% endif %}

    {% assign required_pack_codes = "" | split:"|" %}
    {% for p in mod_packs_raw %}
      {% assign code = p | strip %}
      {% if code and code != "" and code != "BG" %}
        {% assign required_pack_codes = required_pack_codes | push: code %}
      {% endif %}
    {% endfor %}

    {% if required_pack_codes.size > 0 %}
      <div style="display:flex; align-items:center; gap:10px; padding-left:22px; border-left:1px solid #f1f5f9;">
        {% for pack_code in required_pack_codes %}
          {% assign pack_data = site.data.packs[pack_code] %}
          {% assign pack_name = pack_data.en | default: pack_code %}
          {% assign icon_path = "/assets/img/packs/" | append: pack_code | downcase | append: ".png" %}
          <img
            src="{{ site.baseurl }}{{ icon_path }}"
            alt="{{ pack_name }} ({{ pack_code }})"
            title="{{ pack_name }} ({{ pack_code }})"
            style="width:36px; height:36px; object-fit:contain;"
          >
        {% endfor %}
      </div>
    {% endif %}

  </div>
</header>
