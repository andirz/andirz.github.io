{%- comment -%}
related-mods.html (NEW)
- Uses real pages from site.mods (like categories.html should)
- Matches by categories
- Outputs 6 icon-only pills (2 rows × 3)
- Forces links to stay clickable (z-index / pointer-events)
{%- endcomment -%}

{%- assign max_items = 6 -%}
{%- assign count = 0 -%}

{%- assign current_id = page.mod_id -%}

{%- comment -%} Current categories: page first, then data fallback {%- endcomment -%}
{%- assign current_categories = page.categories -%}
{%- if current_categories == nil -%}
  {%- assign current_data = site.data.mods | where: "id", current_id | first -%}
  {%- assign current_categories = current_data.categories -%}
{%- endif -%}
{%- if current_categories == nil -%}
  {%- assign current_categories = "" | split: "|" -%}
{%- endif -%}

<section class="rm-wrap">
  <div class="rm-title">Related Mods:</div>

  <div class="rm-grid">
    {%- for p in site.mods -%}
      {%- if count < max_items -%}
        {%- if p.mod_id != current_id -%}

          {%- assign p_categories = p.categories -%}
          {%- if p_categories == nil -%}
            {%- assign p_data = site.data.mods | where: "id", p.mod_id | first -%}
            {%- assign p_categories = p_data.categories -%}
          {%- endif -%}
          {%- if p_categories == nil -%}
            {%- assign p_categories = "" | split: "|" -%}
          {%- endif -%}

          {%- assign match = false -%}
          {%- for c in p_categories -%}
            {%- if current_categories contains c -%}
              {%- assign match = true -%}
            {%- endif -%}
          {%- endfor -%}

          {%- if match -%}
            {%- assign p_name = p.title | default: p.name -%}
            {%- if p_name == nil or p_name == "" -%}
              {%- assign p_data2 = site.data.mods | where: "id", p.mod_id | first -%}
              {%- assign p_name = p_data2.name -%}
            {%- endif -%}

            <a class="rm-pill" href="{{ p.url | relative_url }}" title="{{ p_name }}" aria-label="{{ p_name }}">
              <i class="fas fa-puzzle-piece" aria-hidden="true"></i>
            </a>

            {%- assign count = count | plus: 1 -%}
          {%- endif -%}

        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}
  </div>
</section>

<style>
/* Minimal + robust: should not interfere with your layout */
.rm-wrap{
  margin-top: 1.1rem;
  position: relative;
  z-index: 2;              /* sit above annoying overlays */
}

.rm-title{
  font-weight: 900;
  font-size: 1.1rem;
  margin-bottom: 10px;
}

/* 2 rows × 3 */
.rm-grid{
  display: grid;
  grid-template-columns: repeat(3, 56px);
  gap: 14px 16px;
  position: relative;
  z-index: 3;
}

/* Icon-only pill, always clickable */
.rm-pill{
  width: 56px;
  height: 36px;
  border-radius: 999px;

  display: flex;
  align-items: center;
  justify-content: center;

  text-decoration: none !important;

  background: rgba(0,0,0,0.035);
  color: rgba(0,0,0,0.50);

  position: relative;
  z-index: 10;
  pointer-events: auto !important;

  transition: transform 120ms ease, background 120ms ease;
}

.rm-pill:hover{
  background: rgba(0,0,0,0.07);
  transform: translateY(-1px);
}

.rm-pill i{
  font-size: 0.95rem;
  opacity: 0.85;
}
</style>
