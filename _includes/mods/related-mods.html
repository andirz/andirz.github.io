{%- comment -%}
related-mods.html (ALT CONCEPT)
- Reuses the SAME pill markup/classes as categories.html: .cat-cloud + .cat-pill
- Only mini overrides for 2×3 icon pills
- Uses site.mods pages for links (most reliable)
{%- endcomment -%}

{%- assign max_items = 6 -%}
{%- assign count = 0 -%}
{%- assign current_id = page.mod_id -%}

{%- assign current_categories = page.categories -%}
{%- if current_categories == nil -%}
  {%- assign current_data = site.data.mods | where: "id", current_id | first -%}
  {%- assign current_categories = current_data.categories -%}
{%- endif -%}
{%- if current_categories == nil -%}
  {%- assign current_categories = "" | split: "|" -%}
{%- endif -%}

<div class="rm-related">
  <strong class="rm-title">Related Mods:</strong>

  <div class="cat-cloud rm-cloud">
    {%- for p in site.mods -%}
      {%- if count < max_items and p.mod_id != current_id -%}

        {%- assign p_categories = p.categories -%}
        {%- if p_categories == nil -%}
          {%- assign p_data = site.data.mods | where: "id", p.mod_id | first -%}
          {%- assign p_categories = p_data.categories -%}
        {%- endif -%}
        {%- if p_categories == nil -%}
          {%- assign p_categories = "" | split: "|" -%}
        {%- endif -%}

        {%- assign match = false -%}
        {%- for c in p_categories -%}
          {%- if current_categories contains c -%}
            {%- assign match = true -%}
          {%- endif -%}
        {%- endfor -%}

        {%- if match -%}
          {%- assign p_name = p.title | default: p.name -%}
          {%- if p_name == nil or p_name == "" -%}
            {%- assign p_data2 = site.data.mods | where: "id", p.mod_id | first -%}
            {%- assign p_name = p_data2.name -%}
          {%- endif -%}

          <a class="cat-pill rm-pill" href="{{ p.url | relative_url }}" title="{{ p_name }}" aria-label="{{ p_name }}">
            <i class="fas fa-puzzle-piece" aria-hidden="true"></i>
            <span class="rm-sr">{{ p_name }}</span>
          </a>

          {%- assign count = count | plus: 1 -%}
        {%- endif -%}

      {%- endif -%}
    {%- endfor -%}
  </div>
</div>

<style>
/* mini layout: 2 rows × 3 */
.rm-cloud{
  display: grid !important;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px 18px;
  margin-top: 10px;
}

/* shrink the categories pill into icon-only */
.cat-pill.rm-pill{
  justify-content: center;
  gap: 0;
  width: 64px;
  height: 40px;
  padding: 0;
}

/* hide text but keep it accessible */
.rm-sr{
  position: absolute;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border: 0;
}

.rm-title{
  display: block;
  margin-bottom: 6px;
}
</style>
