{% comment %}
  Usage:
  {% include mod-gallery.html %}
  Optional params:
  - exclude_cover: true/false (default true)
  - columns: 2..6 (default 3)
{% endcomment %}

{% assign filename = page.path | split: "/" | last | replace: ".md", "" %}
{% assign current_id = page.mod_id | default: filename %}

{% assign gallery_dir = "/assets/img/mods/" | append: current_id | append: "/" %}
{% assign exclude_cover = include.exclude_cover %}
{% if exclude_cover == nil %}
  {% assign exclude_cover = true %}
{% endif %}

{% assign columns = include.columns | default: 3 %}

{% assign images = site.static_files
  | where_exp: "f", "f.path contains gallery_dir"
  | where_exp: "f", "f.extname == '.png' or f.extname == '.jpg' or f.extname == '.jpeg' or f.extname == '.webp' or f.extname == '.gif'"
%}

{% if exclude_cover %}
  {% assign images = images | where_exp: "f", "f.name != 'cover.png'" %}
{% endif %}

{% if images and images.size > 0 %}
  <div class="mod-gallery mod-gallery-cols-{{ columns }}">
    {% for img in images %}
      <a class="mod-gallery-item" href="{{ img.path }}" target="_blank" rel="noopener noreferrer">
        <img src="{{ img.path }}" alt="{{ img.name | replace: '-', ' ' | replace: '_', ' ' | replace: img.extname, '' }}">
      </a>
    {% endfor %}
  </div>

  <style>
    .mod-gallery{
      display:grid;
      gap:10px;
      margin: 12px 0 0;
    }

    .mod-gallery-cols-2{ grid-template-columns: repeat(2, 1fr); }
    .mod-gallery-cols-3{ grid-template-columns: repeat(3, 1fr); }
    .mod-gallery-cols-4{ grid-template-columns: repeat(4, 1fr); }
    .mod-gallery-cols-5{ grid-template-columns: repeat(5, 1fr); }
    .mod-gallery-cols-6{ grid-template-columns: repeat(6, 1fr); }

    .mod-gallery-item{
      display:block;
      border-radius:12px;
      overflow:hidden;
      border:1px solid rgba(31,41,55,0.25);
      background:#fff;
      transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease;
    }

    .mod-gallery-item:hover{
      transform: scale(1.02);
      border-color: rgba(31,41,55,0.45);
      box-shadow: 0 10px 22px rgba(0,0,0,0.10);
    }

    .mod-gallery-item img{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
      aspect-ratio: 4/3;
    }

    @media (max-width: 900px){
      .mod-gallery-cols-4,
      .mod-gallery-cols-5,
      .mod-gallery-cols-6{ grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 600px){
      .mod-gallery{ grid-template-columns: repeat(2, 1fr) !important; }
    }
  </style>
{% endif %}
