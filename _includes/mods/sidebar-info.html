{% comment %} Requirements Box {% endcomment %}
{% if final_reqs.size > 0 or page.packs.size > 0 or page.optional_packs.size > 0 %}
<div class="sidebar-box" style="background: white; border: 2px solid #e2e8f0; border-radius: 16px; overflow: hidden; margin-bottom: 20px;">
  <div style="padding: 10px; background: #1e293b; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; color: #ffffff; letter-spacing: 1px;">Requirements</div>
  <div style="padding: 20px;">
    
    {% comment %} Liste der Script-AbhÃ¤ngigkeiten (aus DB) {% endcomment %}
    {% if final_reqs.size > 0 %}
      <ul style="margin: 0 0 15px 0; padding: 0; list-style: none;">
        {% for req_id in final_reqs %}
          {% assign req_mod_data = site.data.mods | where: "id", req_id | first %}
          {% assign dep_data = site.data.dependencies[req_id] %}
          {% assign req_icon = req_mod_data.icon | default: dep_data.icon | default: "fas fa-puzzle-piece" %}
          
          <li style="margin-bottom: 12px; display: flex; align-items: center; font-size: 0.9rem;">
            <i class="{{ req_icon }}" style="margin-right: 12px; color: #3b82f6; width: 20px; text-align: center;"></i>
            <a href="{{ req_mod_data.url | default: dep_data.url | default: '#' }}" style="color: #2563eb; font-weight: 700; text-decoration: none;">
              {{ req_mod_data.name | default: dep_data.name | default: req_id }}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% comment %} Zwingend erforderliche DLC Packs {% endcomment %}
    {% if page.packs.size > 0 %}
      <div style="border-top: 2px solid #f1f5f9; margin-top: 10px; padding-top: 15px;">
         <div style="font-size: 0.65rem; font-weight: 900; color: #64748b; text-transform: uppercase; margin-bottom: 10px;">Required DLC</div>
         <div style="display: flex; flex-direction: column; gap: 8px;">
           {% for pack_id in page.packs %}
             {% assign pack_info = site.data.packs[pack_id] %}
             <div style="background: #eff6ff; color: #1e40af; padding: 6px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 700; border: 1px solid #dbeafe; display: flex; align-items: center; gap: 8px;">
               <i class="fas fa-box-open" style="font-size: 0.7rem; color: #3b82f6;"></i>
               <span style="background: #3b82f6; color: white; font-size: 0.6rem; padding: 2px 4px; border-radius: 3px; font-weight: 900;">{{ pack_id }}</span>
               {{ pack_info.en | default: pack_id }}
             </div>
           {% endfor %}
         </div>
      </div>
    {% endif %}

    {% comment %} NEU: Optionale Packs zur Gameplay-Erweiterung {% endcomment %}
    {% if page.optional_packs.size > 0 %}
      <div style="border-top: 2px solid #f1f5f9; margin-top: 15px; padding-top: 15px;">
         <div style="font-size: 0.65rem; font-weight: 900; color: #64748b; text-transform: uppercase; margin-bottom: 10px;">Optional (Enhanced Gameplay)</div>
         <div style="display: flex; flex-direction: column; gap: 8px;">
           {% for pack_id in page.optional_packs %}
             {% assign pack_info = site.data.packs[pack_id] %}
             <div style="background: #f0fdf4; color: #166534; padding: 6px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 700; border: 1px solid #dcfce7; display: flex; align-items: center; gap: 8px;">
               <i class="fas fa-plus-circle" style="font-size: 0.7rem; color: #22c55e;"></i>
               <span style="background: #22c55e; color: white; font-size: 0.6rem; padding: 2px 4px; border-radius: 3px; font-weight: 900;">{{ pack_id }}</span>
               {{ pack_info.en | default: pack_id }}
             </div>
           {% endfor %}
         </div>
      </div>
    {% endif %}

  </div>
</div>
{% endif %}