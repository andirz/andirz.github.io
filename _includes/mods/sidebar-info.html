{% comment %}
  ID aus dem Dateinamen extrahieren
{% endcomment %}
{% assign filename = page.path | split: "/" | last | replace: ".md", "" %}
{% assign current_id = page.mod_id | default: filename %}

{% assign mod = site.data.mods | where: "id", current_id | first %}
{% assign mod_full_name = mod.name | default: page.title %}
{% assign current_version = page.version | default: mod.version %}
{% assign final_reqs = page.requirements | default: mod.requirements %}
{% assign patreon_link = mod.patreon | default: site.data.globals.links.patreon %}
{% assign kofi_link = site.data.globals.links.kofi %}
{% assign paypal_link = site.data.globals.links.paypal %}
{% assign cf_url = "https://www.curseforge.com/sims4/mods/" | append: (current_id | replace: '_', '-') %}

{% assign expected_cover_path = "/assets/img/mods/" | append: current_id | append: "/cover.png" %}
{% assign cover_exists = false %}
{% for file in site.static_files %}
  {% if file.path == expected_cover_path %}
    {% assign cover_exists = true %}
    {% break %}
  {% endif %}
{% endfor %}

{% assign has_reqs = final_reqs and final_reqs.size > 0 %}
{% assign has_packs = page.packs and page.packs.size > 0 %}

<div class="sticky-sidebar-wrapper">

  <!-- MOD CARD -->
  <div class="sidebar-box">

    <!-- COVER -->
    <div class="sidebar-cover">
      {% if cover_exists %}
        <a href="{{ expected_cover_path }}" target="_blank" rel="noopener noreferrer">
          <img src="{{ expected_cover_path }}" alt="{{ mod_full_name }}">
        </a>
      {% else %}
        <div class="cover-fallback" aria-label="No cover image">
          <i class="{{ page.icon | default: mod.icon | default: 'fas fa-box' }}"></i>
        </div>
      {% endif %}
    </div>

    <!-- CONTENT -->
    <div class="sidebar-content">
      <h3>{{ mod_full_name }}</h3>

      <div class="meta">
        <span>v. {{ current_version }}</span>

        <div class="files">
          {% if page.files contains 'ts4script' %}
            <i class="fas fa-code" title="Script Mod"></i>
          {% endif %}
          {% if page.files contains 'bat' %}
            <i class="fas fa-terminal" title="Batch Tool"></i>
          {% endif %}
          {% unless page.files contains 'ts4script' or page.files contains 'bat' %}
            <i class="fas fa-box" title="Package Mod"></i>
          {% endunless %}
        </div>
      </div>
    </div>
  </div>

  <!-- REQUIREMENTS -->
  {% if has_reqs or has_packs %}
  <div class="sidebar-box">

    <div class="sidebar-box-header">Requirements</div>

    <div class="sidebar-box-content">

      {% if has_reqs %}
      <ul class="requirements-list">
        {% for req_id in final_reqs %}
          {% assign dep = site.data.dependencies[req_id] %}
          <li>
            <i class="{{ dep.icon | default: 'fas fa-puzzle-piece' }}"></i>
            <a href="{{ dep.url | default:'#' }}" target="_blank" rel="noopener noreferrer">
              {{ dep.name | default: req_id }}
            </a>
          </li>
        {% endfor %}
      </ul>
      {% endif %}

      {% if has_packs %}
      <div class="packs-block{% unless has_reqs %} no-divider{% endunless %}">
        <strong>
          {% if page.require_any_pack %}
            Any of these packs:
          {% else %}
            Required packs:
          {% endif %}
        </strong>

        <div class="packs-list">
          {% for pack in page.packs %}
            {% assign pack_en = site.data.packs[pack].en | default: pack %}
            <span class="pack-pill" title="{{ pack_en }}" aria-label="{{ pack_en }}">{{ pack }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}

    </div>
  </div>
  {% endif %}

  <!-- DOWNLOAD -->
  <div class="sidebar-box">
    <div class="sidebar-box-header">Download</div>

    <div class="download-wrap">
      {% unless page.curseforge_ban %}
      <a href="{{ cf_url }}" target="_blank" rel="noopener noreferrer" class="download-btn cf-btn">
        <i class="fab fa-firefox-browser" aria-hidden="true"></i>
        <span>CurseForge</span>
      </a>
      {% endunless %}

      <a href="{{ patreon_link }}" target="_blank" rel="noopener noreferrer" class="download-btn patreon-btn">
        <i class="fab fa-patreon" aria-hidden="true"></i>
        <span>Patreon</span>
      </a>
    </div>
  </div>

  <!-- SUPPORT -->
  <div class="support-icons">
    <a class="support-link patreon" href="{{ patreon_link }}" target="_blank" rel="noopener noreferrer" aria-label="Patreon">
      <i class="fab fa-patreon" aria-hidden="true"></i>
    </a>
    <a class="support-link kofi" href="{{ kofi_link }}" target="_blank" rel="noopener noreferrer" aria-label="Ko-fi">
      <i class="fas fa-coffee" aria-hidden="true"></i>
    </a>
    <a class="support-link paypal" href="{{ paypal_link }}" target="_blank" rel="noopener noreferrer" aria-label="PayPal">
      <i class="fab fa-paypal" aria-hidden="true"></i>
    </a>
  </div>

</div>

<style>
:root{ --soft-black:#1f2937; }

/* LAYOUT */
.sticky-sidebar-wrapper{ position:sticky; top:20px; }

/* BOX */
.sidebar-box{
  background:#fff;
  border:1px solid var(--soft-black);
  border-radius:14px;
  overflow:hidden;
  margin-bottom:14px;
}

/* HEADER – ohne Hintergrund, nur “schön” unterstrichen */
.sidebar-box-header{
  background:transparent;
  color:var(--soft-black);
  font-size:0.7rem;
  font-weight:900;
  text-align:center;
  padding:10px 14px 7px;
  text-transform:uppercase;
  letter-spacing:1.2px;
  border-bottom:2px solid var(--soft-black);
}

.sidebar-box-content{ padding:12px 14px; }

/* COVER – größer & dominanter */
.sidebar-cover{
  position:relative;
  aspect-ratio:4/3;
  overflow:hidden;
  border-bottom:1px solid var(--soft-black);
}

.sidebar-cover > a,
.sidebar-cover > a > img{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
}

.sidebar-cover > a > img{ object-fit:cover; }

.cover-fallback{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#f3f4f6;
  color:var(--soft-black);
}

.cover-fallback i{ font-size:56px; }

/* CONTENT – kompakt */
.sidebar-content{
  padding:8px 14px 12px;
  text-align:center;
}

.sidebar-content h3{
  margin:2px 0 4px;
  font-size:1.05rem;
  line-height:1.2;
}

.meta{
  margin-top:2px;
  font-size:0.75rem;
  color:#6b7280;
  display:flex;
  justify-content:center;
  gap:6px;
  align-items:center;
}

.files{
  display:flex;
  gap:6px;
  border-left:1px solid var(--soft-black);
  padding-left:8px;
}

.files i{ font-size:0.8rem; }

/* REQUIREMENTS */
.requirements-list{ list-style:none; padding:0; margin:0; }
.requirements-list li{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:0.85rem;
  margin-bottom:8px;
}

.requirements-list a{
  font-weight:800;
  text-decoration:none;
  color:var(--soft-black);
  transition:color .15s ease, text-decoration-color .15s ease;
}

.requirements-list a:hover{
  color:#2563eb;
  text-decoration:underline;
  text-decoration-thickness:2px;
  text-underline-offset:3px;
}

.packs-block{
  border-top:1px solid #e5e7eb;
  margin-top:8px;
  padding-top:6px;
  font-size:0.7rem;
}
.packs-block.no-divider{ border-top:none; margin-top:0; padding-top:0; }

.packs-list{
  margin-top:6px;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.pack-pill{
  background:#eff6ff;
  border:1px solid #dbeafe;
  border-radius:4px;
  padding:2px 6px;
  font-weight:800;
  cursor: help; 
}

/* DOWNLOAD */
.download-wrap{
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* Button: Text mittig, Icon links am Anfang */
.download-btn{
  position:relative;
  display:block;
  padding:10px 12px;
  border-radius:9px;
  font-weight:900;
  font-size:0.85rem;
  color:#fff !important;
  text-decoration:none;
  text-align:center;
  transition:filter .2s ease, transform .15s ease;
}

.download-btn i{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  font-size:1rem;
  opacity:0.95;
}

.download-btn:hover{
  filter:brightness(1.12);
  transform:translateY(-1px);
}

.cf-btn{ background:#f16436; }
.patreon-btn{ background:#1e293b; }

/* SUPPORT ICONS – Brand-Farben + Hover-Zoom */
.support-icons{
  display:flex;
  justify-content:center;
  gap:22px;
  padding:8px 0 4px;
}

.support-link{
  font-size:1.45rem;
  text-decoration:none;
  transition:transform .18s cubic-bezier(0.175,0.885,0.32,1.275), filter .18s ease;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}

.support-link:hover{
  transform:scale(1.35);
  filter:brightness(1.05);
}

.support-link.patreon{ color:#ff424d; } /* Patreon */
.support-link.kofi{ color:#ff5e5b; }    /* Ko-fi */
.support-link.paypal{ color:#003087; }  /* PayPal */
</style>
