{% comment %} Daten laden & Fallbacks {% endcomment %}
{% assign mod = site.data.mods | where: "id", page.mod_id | first %}
{% assign current_version = page.version | default: mod.version %}
{% assign final_reqs = page.requirements | default: mod.requirements %}
{% assign patreon_link = mod.patreon | default: site.data.globals.links.patreon %} 
{% assign kofi_link = site.data.globals.links.kofi %}
{% assign cf_url = "https://www.curseforge.com/sims4/mods/" | append: (page.mod_id | replace: '_', '-') %}

<div class="sticky-sidebar-wrapper" style="position: sticky; top: 20px;">
  
  {% comment %} Mod Info Box {% endcomment %}
  <div class="sidebar-box" style="background: white; border: 2px solid #e2e8f0; border-radius: 16px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);">
    
    {% comment %} Cover Bereich {% endcomment %}
    <div style="width: 100%; background: #f8fafc; border-bottom: 2px solid #3b82f6; display: flex; justify-content: center; align-items: center;">
      {% if page.cover or mod.cover %}
        <img src="{{ page.cover | default: mod.cover }}" style="width: 100%; height: auto; display: block;">
      {% else %}
        <div style="padding: 40px 0; font-size: 60px; color: #3b82f6;">
           <i class="{{ page.icon | default: mod.icon | default: 'fas fa-box' }}"></i>
        </div>
      {% endif %}
    </div>

    <div style="padding: 20px; text-align: center;">
      <h3 style="font-size: 1.3rem; margin: 0; color: #0f172a; font-weight: 800;">{{ mod.name | default: page.title }}</h3>
      
      {% comment %} Version & Mod-Type Icons {% endcomment %}
      <div style="margin-top: 8px; display: flex; justify-content: center; align-items: center; gap: 10px; color: #64748b; font-size: 0.85rem; font-weight: 600;">
        <span>v. {{ current_version }}</span>
        
        <div style="display: flex; gap: 5px; margin-left: 5px; border-left: 1px solid #e2e8f0; padding-left: 10px;">
          {% if page.files contains 'ts4script' %}
            <i class="fas fa-microchip" title="Script Mod" style="color: #3b82f6;"></i>
          {% endif %}
          {% if page.files contains 'package' %}
            <i class="fas fa-box" title="Package File" style="color: #6366f1;"></i>
          {% endif %}
          {% if page.files contains 'bat' %}
            <i class="fas fa-terminal" title="Batch Tool" style="color: #1e293b;"></i>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% comment %} Requirements Box (Script & DLC) {% endcomment %}
  {% if final_reqs.size > 0 or page.packs.size > 0 or page.optional_packs.size > 0 %}
    {% endif %}

  {% comment %} Download & Support Box {% endcomment %}
  <div class="sidebar-box" style="background: white; border: 2px solid #e2e8f0; border-radius: 16px; overflow: hidden; margin-bottom: 20px;">
    <div style="padding: 10px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; color: #1e293b; letter-spacing: 1px;">Get the Mod</div>
    
    <div style="padding: 15px; display: flex; flex-direction: column; gap: 10px;">
      {% unless page.curseforge_ban %}
        <a href="{{ cf_url }}" target="_blank" class="download-btn cf-btn">
          <i class="fab fa-firefox-browser"></i> <span>CurseForge</span>
        </a>
      {% endunless %}
      
      <a href="{{ patreon_link }}" target="_blank" class="download-btn patreon-btn">
        <i class="fab fa-patreon"></i> <span>Patreon</span>
      </a>

      {% comment %} NEU: Support Section am Ende {% endcomment %}
      <div style="margin-top: 10px; padding-top: 15px; border-top: 1px solid #f1f5f9; text-align: center;">
        <div style="font-size: 0.65rem; font-weight: 900; color: #94a3b8; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px;">Support my Work</div>
        <div style="display: flex; justify-content: center; gap: 15px;">
          <a href="{{ patreon_link }}" target="_blank" title="Patreon" style="color: #f96854; font-size: 1.1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">
            <i class="fab fa-patreon"></i>
          </a>
          <a href="{{ kofi_link }}" target="_blank" title="Ko-fi" style="color: #29abe0; font-size: 1.1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">
            <i class="fas fa-coffee"></i>
          </a>
          <a href="{{ site.data.globals.links.discord }}" target="_blank" title="Discord" style="color: #5865f2; font-size: 1.1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">
            <i class="fab fa-discord"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

</div>

<style>
  .download-btn {
    position: relative; display: flex; align-items: center; justify-content: center; 
    padding: 12px; border-radius: 12px; text-decoration: none; font-weight: 800; 
    font-size: 0.95rem; transition: all 0.2s ease; color: white !important;
  }
  .download-btn i { position: absolute; left: 20px; font-size: 1.1rem; }
  .cf-btn { background: #f16436; }
  .patreon-btn { background: #1e293b; }
  .cf-btn:hover { background: #d34e26; transform: translateY(-2px); }
  .patreon-btn:hover { background: #3b82f6; transform: translateY(-2px); }
</style>