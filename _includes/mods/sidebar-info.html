{% comment %}
  ID aus dem Dateinamen extrahieren
{% endcomment %}
{% assign filename = page.path | split: "/" | last | replace: ".md", "" %}
{% assign current_id = page.mod_id | default: filename %}

{% assign mod = site.data.mods | where: "id", current_id | first %}
{% assign mod_full_name = mod.name | default: page.title %}
{% assign current_version = page.version | default: mod.version %}
{% assign final_reqs = page.requirements | default: mod.requirements %}
{% assign patreon_link = mod.patreon | default: site.data.globals.links.patreon %}
{% assign kofi_link = site.data.globals.links.kofi %}
{% assign paypal_link = site.data.globals.links.paypal %}
{% assign cf_url = "https://www.curseforge.com/sims4/mods/" | append: (current_id | replace: '_', '-') %}

{% assign expected_cover_path = "/assets/img/mods/" | append: current_id | append: "/cover.png" %}
{% assign cover_exists = false %}
{% for file in site.static_files %}
  {% if file.path == expected_cover_path %}
    {% assign cover_exists = true %}
    {% break %}
  {% endif %}
{% endfor %}

{% assign has_reqs = final_reqs and final_reqs.size > 0 %}
{% assign has_packs = page.packs and page.packs.size > 0 %}

<div class="sticky-sidebar-wrapper">

  <div class="sidebar-box">
    <div class="sidebar-cover">
      {% if cover_exists %}
        <a href="{{ expected_cover_path }}" target="_blank" rel="noopener noreferrer">
          <img src="{{ expected_cover_path }}" alt="{{ mod_full_name }}">
        </a>
      {% else %}
        <div class="cover-fallback">
          <i class="{{ page.icon | default: mod.icon | default: 'fas fa-box' }}"></i>
        </div>
      {% endif %}
    </div>

    <div class="sidebar-content">
      <h3>{{ mod_full_name }}</h3>

      <div class="meta">
        <span>v. {{ current_version }}</span>
        <div class="files">
          {% if page.files contains 'ts4script' %}
            <i class="fas fa-code" title="Script Mod"></i>
          {% endif %}
          {% if page.files contains 'bat' %}
            <i class="fas fa-terminal" title="Batch Tool"></i>
          {% endif %}
          {% unless page.files contains 'ts4script' or page.files contains 'bat' %}
            <i class="fas fa-box" title="Package Mod"></i>
          {% endunless %}
        </div>
      </div>
    </div>
  </div>

  {% if has_reqs or has_packs %}
  <div class="sidebar-box">
    <div class="sidebar-box-header">Requirements</div>

    <div class="sidebar-box-content">
      {% if has_reqs %}
      <ul class="requirements-list">
        {% for req_id in final_reqs %}
          {% assign dep = site.data.dependencies[req_id] %}
          <li>
            <i class="{{ dep.icon | default: 'fas fa-puzzle-piece' }}"></i>
            <a href="{{ dep.url | default:'#' }}" target="_blank" rel="noopener noreferrer">
              {{ dep.name | default: req_id }}
            </a>
          </li>
        {% endfor %}
      </ul>
      {% endif %}

      {% if has_packs %}
      <div class="packs-block{% unless has_reqs %} no-divider{% endunless %}">
        <strong>
          {% if page.require_any_pack %}Any of these packs:{% else %}Required packs:{% endif %}
        </strong>
        <div class="packs-list">
          {% for pack in page.packs %}
            {% assign pack_en = site.data.packs[pack].en | default: pack %}
            <span class="pack-pill" title="{{ pack_en }}" aria-label="{{ pack_en }}">{{ pack }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <div class="sidebar-box">
    <div class="sidebar-box-header">Download</div>
    <div class="download-wrap">
      {% unless page.curseforge_ban %}
      <a href="{{ cf_url }}" target="_blank" class="download-btn cf-btn">
        <i class="fab fa-firefox-browser"></i><span>CurseForge</span>
      </a>
      {% endunless %}
      <a href="{{ patreon_link }}" target="_blank" class="download-btn patreon-btn">
        <i class="fab fa-patreon"></i><span>Patreon</span>
      </a>
    </div>
  </div>

  <div class="support-icons">
    <a class="support-link patreon" href="{{ patreon_link }}" target="_blank"><i class="fab fa-patreon"></i></a>
    <a class="support-link kofi" href="{{ kofi_link }}" target="_blank"><i class="fas fa-coffee"></i></a>
    <a class="support-link paypal" href="{{ paypal_link }}" target="_blank"><i class="fab fa-paypal"></i></a>
  </div>
</div>

<style>
:root{ --soft-black:#1f2937; }

/* Header – elegante kurze Linie */
.sidebar-box-header{
  background:none;
  text-align:center;
  font-size:0.7rem;
  font-weight:900;
  letter-spacing:1.2px;
  padding:10px 0 6px;
  position:relative;
}
.sidebar-box-header::after{
  content:"";
  display:block;
  width:60%;
  height:2px;
  background:var(--soft-black);
  margin:6px auto 0;
  opacity:.7;
}

/* Requirements enger */
.requirements-list li{
  margin-bottom:4px;
  font-size:0.83rem;
}
.requirements-list li:last-child{ margin-bottom:0; }

/* Hover-Farbe bleibt */
.requirements-list a{
  font-weight:800;
  color:var(--soft-black);
  text-decoration:none;
}
.requirements-list a:hover{
  color:#2563eb;
  text-decoration:underline;
}

/* Packs */
.pack-pill{ cursor:help; }

/* Support Icons – Farben */
.support-icons{
  display:flex;
  justify-content:center;
  gap:22px;
  padding:8px 0 4px;
}
.support-link{
  font-size:1.45rem;
  transition:transform .18s cubic-bezier(.175,.885,.32,1.275);
}
.support-link:hover{ transform:scale(1.35); }

.support-link.patreon{ color:#000; }
.support-link.paypal{ color:#2563eb; }
.support-link.kofi{
  color:#ff5e5b;
  border:1.5px solid #000;
  border-radius:6px;
  padding:4px 6px;
}
</style>
