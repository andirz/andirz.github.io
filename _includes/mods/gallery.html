{% comment %}
  Split Gallery for Mods
  Uses images from /assets/img/mods/<mod_id>/
{% endcomment %}

{% assign filename = page.path | split: "/" | last | replace: ".md", "" %}
{% assign mod_id = page.mod_id | default: filename %}
{% assign img_base = "/assets/img/mods/" | append: mod_id %}

{% assign images = "" | split: "" %}
{% for file in site.static_files %}
  {% if file.path contains img_base and file.extname != ".svg" %}
    {% assign images = images | push: file.path %}
  {% endif %}
{% endfor %}

{% if images.size > 0 %}
<div class="mod-split-gallery" data-mod-gallery>
  <div class="msg-main">
    <img src="{{ images[0] }}" alt="{{ page.title }} preview">
  </div>

  <div class="msg-thumbs">
    {% for img in images %}
      <button type="button"
              class="msg-thumb{% if forloop.first %} active{% endif %}"
              data-img="{{ img }}"
              aria-label="Show image {{ forloop.index }}">
        <img src="{{ img }}" alt="">
      </button>
    {% endfor %}
  </div>
</div>
{% endif %}

<style>
.mod-split-gallery{
  display:grid;
  grid-template-columns: 1fr 140px;
  gap:16px;
  margin:18px 0 26px;
}

.msg-main{
  background:#000;
  border-radius:14px;
  overflow:hidden;
  border:1px solid var(--border-color);
}

.msg-main img{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
  display:block;
}

.msg-thumbs{
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow:auto;
}

.msg-thumb{
  all:unset;
  cursor:pointer;
  border-radius:10px;
  overflow:hidden;
  border:2px solid transparent;
  background:#000;
}

.msg-thumb img{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
  display:block;
}

.msg-thumb.active{
  border-color:var(--accent-color);
}

@media (max-width: 900px){
  .mod-split-gallery{
    grid-template-columns:1fr;
  }
  .msg-thumbs{
    flex-direction:row;
  }
  .msg-thumb{
    min-width:120px;
  }
}
</style>

<script>
(() => {
  const gallery = document.querySelector('[data-mod-gallery]');
  if (!gallery) return;

  const mainImg = gallery.querySelector('.msg-main img');
  const thumbs = gallery.querySelectorAll('.msg-thumb');

  thumbs.forEach(btn => {
    btn.addEventListener('click', () => {
      thumbs.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      mainImg.src = btn.dataset.img;
    });
  });
})();
</script>
