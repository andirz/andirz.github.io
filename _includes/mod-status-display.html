{% comment %} 
  1. DATEN-SETUP: Holt Daten entweder aus dem Include-Parameter oder der aktuellen Seite
{% endcomment %}
{% assign mod_item = include.mod | default: (site.data.mods | where: "id", page.mod_id | first) %}
{% assign patch_date = site.data.globals.patch_release_date | date: "%s" %}
{% assign mod_date = mod_item.updated | date: "%s" %}

{% comment %} 
  2. STATUS-LOGIK: Berechnet den Status basierend auf dem Datum
{% endcomment %}
{% assign raw_status = mod_item.status | downcase | default: "compatible" %}
{% if raw_status == "updated" or raw_status == "new" or raw_status == "broken" %}
  {% assign display_status = raw_status %}
{% elsif mod_date < patch_date %}
  {% assign display_status = "unknown" %}
{% else %}
  {% assign display_status = "compatible" %}
{% endif %}

{% comment %} 
  3. DESIGN-KONFIGURATION
{% endcomment %}
{% case display_status %}
  {% when 'updated' %}
    {% assign status_color = "#007bff" %}{% assign status_label = "Updated" %}{% assign status_icon = "fas fa-arrow-alt-circle-up" %}
  {% when 'compatible' %}
    {% assign status_color = "#28a745" %}{% assign status_label = "Compatible" %}{% assign status_icon = "fas fa-check-circle" %}
  {% when 'broken' %}
    {% assign status_color = "#dc3545" %}{% assign status_label = "Broken" %}{% assign status_icon = "fas fa-times-circle" %}
  {% when 'new' %}
    {% assign status_color = "#ffc107" %}{% assign status_label = "New" %}{% assign status_icon = "fas fa-plus-circle" %}
  {% else %}
    {% assign status_color = "#6c757d" %}{% assign status_label = "Unknown" %}{% assign status_icon = "fas fa-question-circle" %}
{% endcase %}

{% if include.style == "card" %}
  {% comment %} --- KACHEL DESIGN (Header-Stil) --- {% endcomment %}
  <div class="mod-status-card" style="
    border: 1px solid var(--border-color, #e2e8f0); 
    border-radius: 12px; 
    padding: 20px; 
    background: var(--bg-primary, #fff); 
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    margin-bottom: 20px;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
      <h3 style="margin: 0; font-size: 1.4rem; font-weight: 800; color: var(--text-color, #1e293b);">
        {{ mod_item.name }}
      </h3>
      <span style="
        background: {{ status_color }}; 
        color: white; 
        padding: 6px 15px; 
        border-radius: 20px; 
        font-weight: bold; 
        font-size: 0.75rem; 
        text-transform: uppercase; 
        letter-spacing: 0.5px;">
        {{ status_label }}
      </span>
    </div>

    <div style="display: flex; align-items: center; gap: 20px; color: #64748b; font-size: 0.85rem;">
      <div style="display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-code-branch" style="color: #cbd5e1;"></i>
        <div style="display: flex; flex-direction: column; line-height: 1.1;">
          <span style="font-size: 0.6rem; text-transform: uppercase; color: #94a3b8; font-weight: 800;">Version</span>
          <span style="font-weight: 700; color: #475569;">v. {{ mod_item.version }}</span>
        </div>
      </div>
      
      <div style="display: flex; align-items: center; gap: 8px; padding-left: 20px; border-left: 1px solid #f1f5f9;">
        <i class="fas fa-calendar-alt" style="color: #cbd5e1;"></i>
        <div style="display: flex; flex-direction: column; line-height: 1.1;">
          <span style="font-size: 0.6rem; text-transform: uppercase; color: #94a3b8; font-weight: 800;">Updated</span>
          <span style="font-weight: 700; color: #475569;">{{ mod_item.updated | date: "%b %d, %Y" }}</span>
        </div>
      </div>
    </div>
  </div>

{% else %}
  {% comment %} --- ICON DESIGN (Tabellen-Stil) --- {% endcomment %}
  <div class="mod-status-icon" style="display: inline-block; cursor: help;" 
       title="{{ status_label }}: Verified for Patch {{ site.data.globals.latest_patch }}">
    <i class="{{ status_icon }}" style="color: {{ status_color }}; font-size: 1.3rem;"></i>
  </div>
{% endif %}
