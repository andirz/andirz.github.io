<style>
  .plan-section{
    background:#fff;
    border-radius:24px;
    padding:30px;
    border:1px solid #e2e8f0;
    box-shadow:0 10px 25px -5px rgba(0,0,0,0.05);
    margin:40px 0;
  }
  .plan-badges{ display:flex; flex-wrap:wrap; gap:10px; margin:10px 0 18px; }
  .plan-badge{
    background:#f8fafc;
    border:1px solid rgba(0,0,0,0.07);
    border-radius:999px;
    padding:8px 12px;
    font-weight:700;
    color:#0f172a;
  }
  .plan-danger{ color:#dc3545; }
  .plan-ok{ color:#16a34a; }

  .plan-grid{
    display:grid;
    grid-template-columns: 1fr;
    gap:14px;
    max-width:760px;
    margin:0 auto;
  }
  @media (min-width: 992px){
    .plan-grid{ grid-template-columns: 1.1fr 0.9fr; }
  }

  .plan-card{
    border:1px solid rgba(0,0,0,0.08);
    border-radius:18px;
    padding:16px;
    background:linear-gradient(180deg, rgba(15,23,42,0.03), rgba(15,23,42,0.01));
  }

  .plan-slots{
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:10px;
  }
  .plan-slot{
    border-radius:14px;
    background:#fff;
    border:1px dashed rgba(15,23,42,0.25);
    padding:10px;
    min-height:84px;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .plan-slot .t{ font-weight:800; font-size:0.9rem; opacity:0.85; }
  .plan-slot .a{ font-weight:800; font-size:0.95rem; }
  .plan-slot .s{ font-size:0.82rem; opacity:0.75; }

  .plan-actions{ display:flex; flex-direction:column; gap:10px; }

  .plan-btn{
    width:100%;
    border-radius:14px;
    border:1px solid rgba(0,0,0,0.10);
    background:#fff;
    padding:12px;
    cursor:pointer;
  }
  .plan-btn:hover{
    transform:translateY(-1px);
    box-shadow:0 10px 18px -14px rgba(0,0,0,0.25);
  }
  .plan-btn .name{ font-weight:900; }
  .plan-btn .desc{ font-size:0.88rem; opacity:0.78; }

  .plan-footer{
    max-width:760px;
    margin:14px auto 0;
    color: rgba(15,23,42,0.75);
    font-size:0.95rem;
  }
</style>

<section class="plan-section">
  <h2>Sim Day Planner</h2>

  <div class="plan-badges">
    <div class="plan-badge" id="p-money">Money</div>
    <div class="plan-badge" id="p-energy">Energy</div>
    <div class="plan-badge" id="p-hunger">Hunger</div>
    <div class="plan-badge" id="p-fun">Fun</div>
    <div class="plan-badge" id="p-happy">Happiness</div>
  </div>

  <div class="plan-grid">
    <div class="plan-card">
      <div style="font-weight:900;margin-bottom:10px;">Your Day</div>
      <div class="plan-slots" id="p-slots"></div>
    </div>

    <div class="plan-card">
      <div style="font-weight:900;margin-bottom:10px;">Activities</div>
      <div class="plan-actions" id="p-actions"></div>
    </div>
  </div>

  <div style="margin-top:12px;">
    <button onclick="window.planReset()">Restart</button>
    <button onclick="window.planUndo()">Undo</button>
    <button onclick="window.planFinish()">Finish</button>
  </div>

  <div style="margin-top:10px;font-weight:800;" id="p-status"></div>

  <div class="plan-footer">
    Keep all needs above 0. Plan all 8 slots.
  </div>
</section>

<script>
(function(){

  const ICON = {
    gift: "{{ '/assets/img/games/emily/gift.png' | relative_url }}",
    goodjob: "{{ '/assets/img/games/emily/goodjob.png' | relative_url }}",
    warning: "{{ '/assets/img/games/emily/warning.png' | relative_url }}",
    wave: "{{ '/assets/img/games/emily/wave.png' | relative_url }}",
    wrench: "{{ '/assets/img/games/emily/wrench.png' | relative_url }}",
    writing: "{{ '/assets/img/games/emily/writing.png' | relative_url }}"
  };

  const START = { money:250, energy:60, hunger:60, fun:60, happy:0 };

  const ACTIONS = [
    { id:"sleep", name:"Sleep", icon:ICON.wave, desc:"Recover energy.",
      fx:{ money:0, energy:+28, hunger:-10, fun:-6, happy:+1 } },

    { id:"cook", name:"Cook & Eat", icon:ICON.gift, desc:"Good food.",
      fx:{ money:-15, energy:-6, hunger:+22, fun:+4, happy:+2 } },

    { id:"quick", name:"Quick Meal", icon:ICON.gift, desc:"Fast food.",
      fx:{ money:-8, energy:-3, hunger:+14, fun:+1, happy:+1 } },

    { id:"work", name:"Work", icon:ICON.wrench, desc:"Earn money.",
      fx:{ money:+75, energy:-18, hunger:-14, fun:-18, happy:+3 } },

    { id:"skill", name:"Build Skill", icon:ICON.writing, desc:"Learn stuff.",
      fx:{ money:0, energy:-10, hunger:-6, fun:+6, happy:+4 } },

    { id:"social", name:"Socialize", icon:ICON.wave, desc:"Meet people.",
      fx:{ money:0, energy:-8, hunger:-6, fun:+14, happy:+6 } },

    { id:"game", name:"Play Games", icon:ICON.goodjob, desc:"Have fun.",
      fx:{ money:0, energy:-6, hunger:-5, fun:+20, happy:+5 } },

    { id:"bath", name:"Bath", icon:ICON.gift, desc:"Relax.",
      fx:{ money:-5, energy:+6, hunger:-4, fun:+6, happy:+3 } },
  ];

  const SLOTS = ["Morning 1","Morning 2","Noon 1","Noon 2","Afternoon 1","Afternoon 2","Evening 1","Evening 2"];

  const elSlots = document.getElementById("p-slots");
  const elActions = document.getElementById("p-actions");
  const elStatus = document.getElementById("p-status");

  const badge = {
    money: document.getElementById("p-money"),
    energy: document.getElementById("p-energy"),
    hunger: document.getElementById("p-hunger"),
    fun: document.getElementById("p-fun"),
    happy: document.getElementById("p-happy"),
  };

  let state = {...START};
  let plan = [];
  let slot = 0;
  let history = [];

  function renderBadges(){
    badge.money.textContent = "Money: §" + state.money;
    badge.energy.textContent = "Energy: " + state.energy;
    badge.hunger.textContent = "Hunger: " + state.hunger;
    badge.fun.textContent = "Fun: " + state.fun;
    badge.happy.textContent = "Happiness: " + state.happy;
  }

  function renderSlots(){
    elSlots.innerHTML = "";
    for(let i=0;i<8;i++){
      elSlots.innerHTML += `
        <div class="plan-slot">
          <div class="t">${SLOTS[i]}</div>
          <div class="a">${plan[i]?.name || "—"}</div>
          <div class="s">${plan[i]?.sum || ""}</div>
        </div>`;
    }
  }

  function renderActions(){
    elActions.innerHTML = "";
    ACTIONS.forEach(a=>{
      const b = document.createElement("button");
      b.className = "plan-btn";
      b.innerHTML = `
        <div style="display:flex;gap:10px;">
          <img src="${a.icon}" width="28" height="28">
          <div>
            <div class="name">${a.name}</div>
            <div class="desc">${a.desc}</div>
          </div>
        </div>`;
      b.onclick = ()=>pick(a);
      elActions.appendChild(b);
    });
  }

  function pick(a){
    if(slot>=8) return;
    history.push({state:{...state}, plan:[...plan], slot});

    state.money += a.fx.money;
    state.energy += a.fx.energy;
    state.hunger += a.fx.hunger;
    state.fun += a.fx.fun;
    state.happy += a.fx.happy;

    if(state.money<0||state.energy<0||state.hunger<0||state.fun<0){
      elStatus.innerHTML = `<img src="${ICON.warning}" width="20"> Meltdown!`;
      slot = 8;
      return;
    }

    plan[slot] = { name:a.name, sum:Object.values(a.fx).join(" ") };
    slot++;

    renderBadges();
    renderSlots();
    elStatus.textContent = slot>=8 ? "Day complete!" : "Next: " + SLOTS[slot];
  }

  window.planReset = function(){
    state = {...START};
    plan = [];
    slot = 0;
    history = [];
    renderBadges();
    renderSlots();
    renderActions();
    elStatus.textContent = "Pick an activity.";
  };

  window.planUndo = function(){
    const h = history.pop();
    if(!h) return;
    state = {...h.state};
    plan = [...h.plan];
    slot = h.slot;
    renderBadges();
    renderSlots();
    elStatus.textContent = "Undone.";
  };

  window.planFinish = function(){
    elStatus.innerHTML = `<img src="${ICON.goodjob}" width="20"> Final Happiness: ${state.happy}`;
  };

  window.planReset();

})();
</script>
