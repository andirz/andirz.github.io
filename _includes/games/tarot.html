<div class="tf-root" data-tf>
  <style>
    .tf-wrap{
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(180deg, #06111f, #020617);
      color:#e5e7eb;
      border-radius: 28px;
      padding: 2rem;
      border: 1px solid #1e293b;
      box-shadow: 0 30px 60px rgba(0,0,0,.35);
      max-width: 980px;
      margin: 2rem auto;
      position: relative;
      overflow: hidden;
    }
    .tf-wrap::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at 25% 25%, rgba(46,204,113,.22), transparent 50%),
        radial-gradient(circle at 70% 35%, rgba(56,189,248,.20), transparent 55%),
        radial-gradient(circle at 55% 80%, rgba(168,85,247,.14), transparent 60%);
      filter: blur(12px);
      pointer-events:none;
    }

    .tf-head{position:relative; display:flex; gap:1rem; flex-wrap:wrap; justify-content:space-between; align-items:flex-start;}
    .tf-title h2{margin:0; font-weight:900;}
    .tf-sub{margin:.25rem 0 0 0; color:#94a3b8; max-width: 650px;}

    .tf-controls{display:flex; gap:.6rem; flex-wrap:wrap; align-items:center;}
    .tf-pill{
      background: rgba(2,6,23,.65);
      border: 1px solid rgba(148,163,184,.25);
      border-radius: 999px;
      padding: .4rem .8rem;
      font-weight: 900;
      color:#e5e7eb;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
    }
    .tf-pill:hover{transform: translateY(-2px); border-color: rgba(56,189,248,.65);}
    .tf-pill.active{border-color: rgba(46,204,113,.85); background: rgba(46,204,113,.10);}

    .tf-btn{
      background:#1e293b; color:#e5e7eb;
      border:none; padding:.65rem 1.2rem;
      border-radius: 14px;
      font-weight: 900;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease;
    }
    .tf-btn:hover{background:#334155; transform: translateY(-2px);}

    .tf-stage{position:relative; margin-top: 1.25rem; display:grid; grid-template-columns: 1.1fr .9fr; gap: 18px;}
    @media (max-width: 920px){ .tf-stage{grid-template-columns: 1fr; } }

    .tf-board{
      position:relative;
      background: rgba(2,6,23,.55);
      border: 1px solid rgba(148,163,184,.20);
      border-radius: 22px;
      padding: 1.25rem;
    }

    .tf-cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(120px, 1fr));
      gap: 14px;
      align-items: stretch;
    }
    @media (max-width: 520px){ .tf-cards{grid-template-columns: repeat(2, 1fr);} }

    .tf-card{
      aspect-ratio: 1 / 1.55;
      border-radius: 18px;
      border: 2px solid rgba(148,163,184,.25);
      background: rgba(11,18,32,.85);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      position:relative;
      transition: transform .2s ease, border-color .2s ease, box-shadow .2s ease, opacity .2s ease;
      cursor: pointer;
      user-select:none;
    }
    .tf-card:hover{
      transform: translateY(-4px);
      border-color: rgba(56,189,248,.7);
      box-shadow: 0 18px 30px rgba(0,0,0,.25);
    }

    /* Back ohne Datei */
    .tf-back{
      background:
        radial-gradient(circle at 20% 20%, rgba(46,204,113,.24), transparent 45%),
        radial-gradient(circle at 75% 35%, rgba(56,189,248,.20), transparent 55%),
        linear-gradient(135deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
    }
    .tf-back::after{
      content:"âœ¦";
      font-size: 2.2rem;
      font-weight: 900;
      color: rgba(229,231,235,.85);
      text-shadow: 0 12px 20px rgba(0,0,0,.35);
    }

    .tf-card img{width: 92%; height: 92%; object-fit: contain; display:block;}
    .tf-tag{
      position:absolute; left:10px; top:10px;
      font-size: .78rem;
      font-weight: 900;
      padding: .25rem .55rem;
      border-radius: 999px;
      background: rgba(2,6,23,.65);
      border: 1px solid rgba(148,163,184,.25);
      color:#e5e7eb;
      letter-spacing: .2px;
    }

    .tf-panel{
      background: rgba(2,6,23,.55);
      border: 1px solid rgba(148,163,184,.20);
      border-radius: 22px;
      padding: 1.25rem;
    }
    .tf-prompt{font-weight: 900; margin: 0 0 .75rem 0;}
    .tf-muted{color:#94a3b8; margin: 0 0 .85rem 0;}

    .tf-reading{
      border-top: 1px dashed rgba(148,163,184,.22);
      padding-top: .9rem;
      margin-top: .9rem;
      display:none;
    }
    .tf-reading h3{margin: 0 0 .35rem 0; font-size: 1.05rem; font-weight: 900;}
    .tf-reading p{margin:.35rem 0; color:#e5e7eb; line-height: 1.35; white-space: pre-line;}

    .tf-moodlets{display:flex; flex-wrap:wrap; gap:.4rem; margin-top:.65rem;}
    .tf-moodlet{
      background: rgba(46,204,113,.12);
      border: 1px solid rgba(46,204,113,.28);
      color:#eafff1;
      font-weight: 900;
      font-size: .82rem;
      padding: .28rem .55rem;
      border-radius: 999px;
    }
    .tf-moodlet.bad{
      background: rgba(239,68,68,.12);
      border-color: rgba(239,68,68,.30);
      color:#ffecec;
    }
    .tf-moodlet.neutral{
      background: rgba(56,189,248,.10);
      border-color: rgba(56,189,248,.26);
      color:#eaf7ff;
    }

    .tf-small{font-size:.92rem; color:#94a3b8; margin-top:.85rem;}
  </style>

  <div class="tf-wrap">
    <div class="tf-head">
      <div class="tf-title">
        <h2>Tarot Fortune Teller</h2>
        <p class="tf-sub">Sims-style readings. Pick a spread, draw cards, and get a playful prediction. Sul sul.</p>
      </div>

      <div class="tf-controls">
        <span class="tf-pill active" data-tf-spread="quick">Quick (1)</span>
        <span class="tf-pill" data-tf-spread="three">Classic (3)</span>
        <span class="tf-pill" data-tf-spread="mood">Moodlets (3)</span>
        <button class="tf-btn" type="button" data-tf-draw>Draw</button>
      </div>
    </div>

    <div class="tf-stage">
      <div class="tf-board">
        <div class="tf-cards" data-tf-cards></div>
        <div class="tf-small">Cards show briefly (preload), then flip back. Click to reveal again.</div>
      </div>

      <div class="tf-panel">
        <p class="tf-prompt" data-tf-prompt>Choose a spread and click â€œDrawâ€.</p>
        <p class="tf-muted" data-tf-muted>0% accuracy, 100% Sims energy.</p>

        <div class="tf-reading" data-tf-reading>
          <h3 data-tf-title>Reading</h3>
          <p data-tf-text></p>
          <div class="tf-moodlets" data-tf-moodlets></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const roots = document.querySelectorAll('[data-tf]:not([data-tf-init])');
  if(!roots.length) return;

  const deck = [
    "advocate","chariot","coins","cups","death","emperor","empress","evil",
    "fool","hermit","high_spellcaster","judgment","justice","lovers","magician",
    "moon","star","strength","sun","suspension","swords","temperance",
    "tower","wands","wheel_of_fortune","world"
  ];

  function shuffle(a){ return [...a].sort(()=>Math.random()-0.5); }

  function placeholder(name){
    const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="300" height="460">
  <rect width="100%" height="100%" rx="28" fill="#0b1220"/>
  <text x="50%" y="50%" text-anchor="middle"
        font-size="22" fill="#94a3b8"
        font-family="system-ui" font-weight="900">${name}</text>
</svg>`;
    return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(svg);
  }

  function imgSrc(name){
    return "{{ site.baseurl }}/assets/img/games/tarot/" + name + ".png";
  }

  const meaning = {
    fool:{good:"Spontaneity pays off â€” unless you flirt with the Grim Reaper again.", bad:"Impulses trigger drama. Avoid â€˜Try for Babyâ€™ during a tense moment.", moods:["âœ¨ Inspired","ğŸ˜¬ Embarrassed"]},
    magician:{good:"Skill gain is strong today. You can pull this off.", bad:"You think youâ€™re in control. The game disagrees.", moods:["âš¡ Focused","ğŸŒ€ Confident"]},
    high_spellcaster:{good:"Big spell success energy. Fix things magically.", bad:"Miscast vibes. Donâ€™t experiment with cursed objects.", moods:["ğŸ”® Energized","ğŸ’¥ Dazed"]},
    empress:{good:"Comfort and â€˜treat yourselfâ€™ purchases. Cozy win.", bad:"Too much indulgence. The bills are watching.", moods:["ğŸ’š Happy","ğŸ›‹ï¸ Cozy"]},
    emperor:{good:"Structure wins. Set boundaries (yes, with neighbors).", bad:"Control issues create conflict. Let autonomy breathe.", moods:["ğŸ§± Confident","ğŸ˜¤ Tense"]},
    advocate:{good:"A quiet but powerful talk clears the air.", bad:"Overthinking blocks progress. Stop rehearsing.", moods:["ğŸ§  Focused","ğŸ˜Ÿ Anxious"]},
    lovers:{good:"Romance is boosted. Flirty interactions land.", bad:"Jealousy pop-up incoming. Communicate early.", moods:["ğŸ’– Flirty","ğŸ”¥ Passionate"]},
    chariot:{good:"Momentum! Promotions and wins are likely.", bad:"Youâ€™re speeding. Donâ€™t bulldoze relationships.", moods:["ğŸ Energized","ğŸ˜¤ Tense"]},
    strength:{good:"Gentle confidence. You handle problems like a pro.", bad:"Stubborn pride. Apologizing is a power move.", moods:["ğŸ¦ Confident","ğŸ§Š Calm"]},
    hermit:{good:"Solo time heals. Cancel plans, recharge.", bad:"Isolation turns into gloom. Text someone.", moods:["ğŸŒ™ Reflective","ğŸ˜” Sad"]},
    wheel_of_fortune:{good:"Luck spike. You might find money in inventory.", bad:"RNG is spicy. Backup your plans.", moods:["ğŸ² Lucky","ğŸ«£ Uncertain"]},
    justice:{good:"Fair outcomes. Receipts matter.", bad:"Consequences arrive. Maybe donâ€™t â€˜Swipeâ€™ today.", moods:["âš–ï¸ Focused","ğŸ˜ Serious"]},
    suspension:{good:"Pause day. Avoid bigger mistakes.", bad:"Stuck energy. Donâ€™t doomscroll for 6 Sim hours.", moods:["â¸ï¸ Calm","ğŸ˜µ Confused"]},
    death:{good:"A clean ending opens a better chapter.", bad:"Clinging hurts. Let the storyline evolve.", moods:["ğŸ¦‹ Renewed","ğŸ–¤ Gloomy"]},
    temperance:{good:"Balance. Needs bars stay stable.", bad:"People-pleasing drains you. Say no.", moods:["ğŸ§˜ Calm","ğŸ«§ Balanced"]},
    evil:{good:"Use your villain arc wisely. Set boundaries.", bad:"Drama magnet day. Avoid prank wars.", moods:["ğŸ˜ˆ Mischievous","ğŸ˜¡ Angry"]},
    tower:{good:"A shake-up clears whatâ€™s false. Rebuild better.", bad:"Chaos event. Something breaks. Keep a repair kit.", moods:["âš¡ Shocked","ğŸ˜± Panicked"]},
    star:{good:"Hope buff. Plans align.", bad:"Donâ€™t idealize. Keep it realistic.", moods:["â­ Inspired","ğŸ’™ Hopeful"]},
    moon:{good:"Intuition is strong. Trust vibe checks.", bad:"Mixed messages. Double-check texts.", moods:["ğŸŒ• Dreamy","ğŸŒ€ Uncertain"]},
    sun:{good:"Huge positive energy. Outdoor fun wins.", bad:"Overconfidence can still embarrass you.", moods:["â˜€ï¸ Happy","ğŸ‰ Playful"]},
    judgment:{good:"Level up moment. Learn, move on.", bad:"Stop endless self-critique. Itâ€™s a save.", moods:["ğŸ”” Inspired","ğŸ§  Reflective"]},
    world:{good:"Completion. Celebrate and set a new goal.", bad:"Post-goal emptiness. Start a fresh storyline.", moods:["ğŸ† Confident","âœ¨ Fulfilled"]},
    coins:{good:"Money improves. Sell something. Invest wisely.", bad:"Impulse spending. Avoid Build/Buy rabbit holes.", moods:["ğŸ’° Secure","ğŸ›’ Tempted"]},
    cups:{good:"Friendship and comfort. Deep talks go well.", bad:"Emotional overshare. Save drama for diary.", moods:["ğŸ¥¤ Warm","ğŸ¥º Sensitive"]},
    swords:{good:"Clarity. Finish the task.", bad:"Harsh words. Donâ€™t argue when tired.", moods:["ğŸ—¡ï¸ Focused","ğŸ˜  Irritated"]},
    wands:{good:"Creative burst. Start something fun.", bad:"Restlessness. Donâ€™t start 5 projects.", moods:["ğŸ”¥ Inspired","ğŸƒ Restless"]}
  };

  function getMeaning(card){
    return meaning[card] || {good:"Something interesting unfolds. Keep an eye on neighbors.", bad:"Today feels glitchy. Save often.", moods:["âœ¨ Inspired","ğŸŒ€ Uncertain"]};
  }

  const intros = {
    quick:[
      "Your Plumbob is vibrating. That usually meansâ€¦ something is about to happen.",
      "The Universe rolled a D20 and got â€˜Maybeâ€™. Letâ€™s interpret the vibes.",
      "Someone in your save is about to make a bold decision without permission."
    ],
    three:[
      "Past / Present / Future â€” or: â€˜what you didâ€™, â€˜what youâ€™re doingâ€™, â€˜what breaks nextâ€™.",
      "This spread is basically a loading screen, but with destiny.",
      "We asked the Watcher. The Watcher answered with chaos."
    ],
    mood:[
      "Todayâ€™s emotional buffet: pick your moodlets carefully.",
      "Your feelings may shift faster than autonomy on high.",
      "We checked your auraâ€¦ itâ€™s doing *that thing*."
    ]
  };

  function buildReading(spread, cards){
    const intro = shuffle(intros[spread])[0];
    const parts = cards.map(getMeaning);
    const positive = Math.random() < 0.58;
    const main = positive ? parts.map(p=>p.good).join(" ") : parts.map(p=>p.bad).join(" ");

    const extra = spread === "mood"
      ? "Forecast: emotions may change faster than your Simâ€™s autonomy settings."
      : spread === "three"
        ? "Watcherâ€™s note: if a neighbor shows up uninvited, itâ€™s probably part of the prophecy."
        : "Quick tip: take a screenshot. Future-you will swear this was scripted.";

    const moods = shuffle(parts.flatMap(p=>p.moods || [])).slice(0,3);

    return {
      title: spread === "quick" ? "Quick Fate Check" : spread === "three" ? "Classic 3-Card Spread" : "Moodlets Forecast",
      text: `${intro}\n\n${main}\n\n${extra}`,
      moods
    };
  }

  function moodletSpan(text){
    const bad = /Tense|Angry|Sad|Panicked|Irritated|Dazed|Embarrassed|Anxious|Gloomy/.test(text);
    const s = document.createElement('span');
    s.className = "tf-moodlet " + (bad ? "bad" : "neutral");
    s.textContent = text;
    return s;
  }

  roots.forEach(root=>{
    root.setAttribute('data-tf-init','1');

    const pills = [...root.querySelectorAll('[data-tf-spread]')];
    const btn = root.querySelector('[data-tf-draw]');
    const cardsWrap = root.querySelector('[data-tf-cards]');

    const elPrompt = root.querySelector('[data-tf-prompt]');
    const elMuted = root.querySelector('[data-tf-muted]');
    const elReading = root.querySelector('[data-tf-reading]');
    const elTitle = root.querySelector('[data-tf-title]');
    const elText = root.querySelector('[data-tf-text]');
    const elMoodlets = root.querySelector('[data-tf-moodlets]');

    let spread = "quick";
    let drawn = [];
    let revealCount = 0;
    let lockClicks = false;
    let timer;

    function setSpread(s){
      spread = s;
      pills.forEach(p => p.classList.toggle('active', p.dataset.tfSpread === s));
      elReading.style.display = "none";
      elPrompt.textContent = "Choose a spread and click â€œDrawâ€.";
      elMuted.textContent = "Cards will reveal briefly to preload images, then flip back.";
      cardsWrap.innerHTML = "";
    }

    function createFaceCard(tag, name){
      const el = document.createElement('div');
      el.className = "tf-card";
      el.innerHTML = `<span class="tf-tag">${tag}</span>`;
      const img = document.createElement('img');
      img.src = imgSrc(name);
      img.alt = name;
      img.onerror = () => img.src = placeholder(name);
      el.appendChild(img);
      return el;
    }

    function createBackCard(tag, name){
      const el = document.createElement('div');
      el.className = "tf-card tf-back";
      el.dataset.name = name;
      el.innerHTML = `<span class="tf-tag">${tag}</span>`;
      return el;
    }

    function reveal(el){
      const name = el.dataset.name;
      el.classList.remove('tf-back');
      const tag = el.querySelector('.tf-tag')?.textContent || "";
      el.innerHTML = `<span class="tf-tag">${tag}</span>`;
      const img = document.createElement('img');
      img.src = imgSrc(name);
      img.alt = name;
      img.onerror = () => img.src = placeholder(name);
      el.appendChild(img);
    }

    function showReading(){
      const reading = buildReading(spread, drawn);
      elTitle.textContent = reading.title;
      elText.textContent = reading.text;

      elMoodlets.innerHTML = "";
      reading.moods.forEach(m => elMoodlets.appendChild(moodletSpan(m)));

      elReading.style.display = "block";
      elPrompt.textContent = "Your reading is ready.";
      elMuted.textContent = "Draw again if you want a different timeline.";
    }

    function draw(){
      clearTimeout(timer);
      elReading.style.display = "none";
      lockClicks = true;
      revealCount = 0;

      const count = spread === "quick" ? 1 : 3;
      drawn = shuffle(deck).slice(0, count);

      const tags = spread === "quick"
        ? ["FATE"]
        : spread === "three"
          ? ["PAST","PRESENT","FUTURE"]
          : ["MIND","HEART","ENERGY"];

      cardsWrap.innerHTML = "";
      drawn.forEach((name,i) => cardsWrap.appendChild(createFaceCard(tags[i], name)));

      elPrompt.textContent = "Memorize the vibeâ€¦";
      elMuted.textContent = "Flipping back in a momentâ€¦";

      timer = setTimeout(()=>{
        cardsWrap.innerHTML = "";
        drawn.forEach((name,i)=>{
          const el = createBackCard(tags[i], name);
          el.addEventListener('click', ()=>{
            if(lockClicks) return;
            if(el.classList.contains('tf-back')){
              reveal(el);
              revealCount++;
              if(revealCount === count) showReading();
            }
          });
          cardsWrap.appendChild(el);
        });

        lockClicks = false;
        elPrompt.textContent = "Click each card to reveal your reading.";
        elMuted.textContent = "Sims logic applies. Chaos included.";
      }, 1200);
    }

    pills.forEach(p => p.addEventListener('click', ()=>setSpread(p.dataset.tfSpread)));
    btn.addEventListener('click', draw);

    setSpread("quick");
  });
})();
</script>
